{"version":3,"sources":["webpack:///./frontend/src/lib/utils.js","webpack:///./frontend/src/scenes/trends/trendsLogic.js","webpack:///./frontend/src/models/actionsModel.js","webpack:///./frontend/src/lib/components/PropertyFilters/PropertyValue.js","webpack:///./frontend/src/lib/components/PropertyFilters/PropertyFilter.js","webpack:///./frontend/src/lib/components/PropertyFilters/propertyFilterLogic.js","webpack:///./frontend/src/lib/components/PropertyFilters/PropertyFilters.js","webpack:///./node_modules/moment/locale sync ^\\.\\/.*$","webpack:///./frontend/src/lib/components/DateFilter.js","webpack:///./frontend/src/scenes/funnels/funnelLogic.js","webpack:///./frontend/src/scenes/trends/ActionFilter/entityFilterLogic.js","webpack:///./frontend/src/scenes/trends/ActionSelectInfo.js","webpack:///./frontend/src/lib/components/ActionSelectTab.js","webpack:///./frontend/src/lib/components/ActionSelectBox.js","webpack:///./frontend/src/scenes/trends/ActionFilter/ActionFilterDropdown.js","webpack:///./frontend/src/scenes/trends/ActionFilter/ActionFilterRow.js","webpack:///./frontend/src/scenes/trends/ActionFilter/ActionFilter.js","webpack:///./frontend/src/scenes/funnels/FunnelViz.js","webpack:///./node_modules/funnel-graph-js/index.js","webpack:///./frontend/src/lib/components/SaveToDashboard.js","webpack:///./node_modules/funnel-graph-js/src/js/number.js","webpack:///./node_modules/funnel-graph-js/src/js/path.js","webpack:///./node_modules/funnel-graph-js/src/js/graph.js","webpack:///./node_modules/funnel-graph-js/src/js/random.js","webpack:///./node_modules/funnel-graph-js/src/js/main.js","webpack:///./frontend/src/scenes/funnels/EditFunnel.js","webpack:///./frontend/src/scenes/funnels/People.js","webpack:///./frontend/src/scenes/funnels/Funnel.js"],"names":["uuid","replace","c","crypto","getRandomValues","Uint8Array","toString","toParams","obj","Object","entries","filter","map","key","val","_isAMomentObject","encodeURIComponent","format","JSON","stringify","handleVal","join","fromParams","window","location","search","slice","split","reduce","a","b","decodeURIComponent","percentage","division","toLocaleString","undefined","style","maximumFractionDigits","Loading","className","TableRowLoading","colSpan","asOverlay","padding","textAlign","CloseButton","props","aria-hidden","Card","title","children","DeleteWithUndo","href","onClick","e","preventDefault","deleteWithUndo","undo","api","update","endpoint","object","id","deleted","then","callback","response","name","toast","toastId","propTypes","PropTypes","string","isRequired","shape","number","selectStyle","control","base","height","minHeight","indicatorsContainer","input","paddingBottom","paddingTop","margin","opacity","valueContainer","marginTop","option","debounce","func","wait","immediate","timeout","context","this","args","arguments","later","apply","callNow","clearTimeout","setTimeout","capitalizeFirstLetter","charAt","toUpperCase","operatorMap","exact","is_not","icontains","not_icontains","gt","lt","operatorEntries","reverse","formatFilterName","str","value","includes","deletePersonData","person","confirm","objectsEqual","obj1","obj2","EntityTypes","ACTIONS","EVENTS","NEW_ENTITY","disableMinuteFor","dStart","mStart","yStart","all","disableHourFor","ViewType","FILTERS","SESSIONS","cleanFilters","filters","interval","autocorrectInterval","display","session","actions","Array","isArray","events","properties","filterClientSideParams","people_day","people_action","stickiness_days","date_from","minute_disabled","hour_disabled","trendsLogic","kea","dashboardItemId","connect","values","userLogic","actionsModel","loaders","results","loadResults","activeView","get","toAPIParams","setFilters","mergeFilters","fromUrl","setDisplay","loadPeople","action","day","breakdown_value","setShowingPeople","isShowing","setPeople","people","count","setActiveView","type","setCachedUrl","url","reducers","state","router","selectors","searchParams","_","cachedUrls","showingPeople","peopleAction","find","parseInt","peopleDay","listeners","breakpoint","params","entityId","shown_as","date_to","breakdown","filterParams","actionToUrl","pathname","cachedUrl","urlToAction","cleanSearchParams","keys","length","eventNames","event","order","actionContains","steps","step","__default","loadActions","actionsGrouped","data","label","options","forEach","push","afterMount","PropertyValue","loadPropertyValues","bind","ref","React","createRef","propertyKey","propValues","property","onSet","isEditing","loadOptions","defaultOptions","cacheOptions","formatCreateLabel","inputValue","allowCreateWhileLoading","createOptionPosition","placeholder","width","onChange","out","setState","select","blur","autoFocus","styles","onFocus","onInputChange","actionMeta","Component","any","operatorOptions","PropertyFilter","index","onComplete","logic","useValues","useActions","setFilter","item","remove","minWidth","isLoading","openMenuOnFocus","operator","isNaN","propertyFilterLogic","pageKey","loadEventProperties","setProperties","newFilter","loadPeopleProperties","loadPeoplePropertiesSuccess","propertyFilters","newFilters","newState","i","dict","result","f","error","mappedFilters","eventProperties","FilterRow","useState","open","setOpen","align","trigger","onVisibleChange","visible","defaultVisible","placement","content","maxWidth","overflow","textOverflow","cursor","float","PropertyFilters","marginBottom","webpackContext","req","webpackContextResolve","__webpack_require__","o","Error","code","resolve","module","exports","dateMapping","Today","Yesterday","isDate","DateFilter","dateRangeOpen","from_date","to_date","v","setDate","document","getElementById","focus","date","rangeDateFrom","rangeDateTo","moment","test","dateFrom","toDate","dateTo","isMoment","bordered","dateFilterToText","marginRight","onBlur","listHeight","dropdownMatchSelectWidth","dropdownRender","menu","DatePickerDropdown","dropdownOnClick","onDateFromChange","onDateToChange","onApplyClick","onClickOutside","Option","dropdownRef","useRef","calendarOpen","setCalendarOpen","current","contains","target","useEffect","addEventListener","removeEventListener","color","fontWeight","popupStyle","zIndex","onOpenChange","defaultValue","disabled","funnelLogic","setFunnel","funnel","loadFunnel","updateFunnel","createFunnel","create","stepsWithCount","loadStepsWithCount","peopleSorted","score","indexOf","sort","isStepsEmpty","loadStepsWithCountSuccess","updateFunnelSuccess","createFunnelSuccess","toLocalFilters","toFilters","localFilters","entityFilterLogic","typeKey","selectFilter","updateFilterMath","math","updateFilter","removeLocalFilter","addFilter","updateFilterProperty","setLocalFilters","selectedFilter","entities","ActionSelectInfo","prevProps","infoDiv","rect","boundingRect","top","left","componentDidMount","entity","isOpen","listStyle","selector","tag_name","text","url_matching","ActionSelectTab","entityType","chooseEntityType","allTypes","flexDirection","borderBottom","backgroundColor","flex","justifyContent","borderTopLeftRadius","borderTopRightRadius","ActionSelectTabs","selected","determineActiveTab","activeTab","setActiveTab","child","labels","ActionSelectPanel","infoOpen","onMouseOver","infoBoundingRect","getBoundingClientRect","infoActionId","onMouseOut","redirect","onHover","relatedTarget","tagName","onSelect","defaultMenuIsOpen","active","components","message","ActionFilterDropdown","eventNamesGrouped","deselect","ActionPanelContainer","panelIndex","alignItems","Link","to","array","bool","ActionFilterRow","node","entityFilterVisible","setEntityFilterVisible","border","MathSelector","onMathSelect","determineFilterLabel","marginLeft","position","items","Dropdown","toLowerCase","buttonClassName","ActionFilter","FunnelViz","buildChart","fetchFunnel","call","funnel_id","container","innerHTML","graph","FunnelGraph","colors","displayPercent","createContainer","graphContainer","createElement","classList","add","appendChild","draw","default","momentToString","SaveToDashboard","Modal","save","closeToast","Toast","openModal","onDismiss","onSubmit","required","roundPoint","Math","round","formatNumber","Number","createCurves","x1","y1","x2","y2","createVerticalCurves","createPath","X","Y","YNext","pop","createVerticalPath","XNext","setAttrs","element","attributes","setAttribute","removeAttrs","attribute","removeAttribute","createSVGElement","el","createElementNS","defaultColors","getDefaultColors","colorSet","abs","random","splice","prefix","containerSelector","gradientDirection","direction","getLabels","subLabels","getSubLabels","getValues","percentages","createPercentages","is2d","getSubDataSize","subLabelValue","size","getDataSize","points","fullDimension","isVertical","getHeight","getWidth","getFullDimension","dimension","totalValues","getValues2d","max","percentagesFull","getPercentages2d","pointsOfFirstPath","p","newPoints","j","point","concat","getGraphType","holder","labelElement","textContent","valueNumber","percentageValue","segmentPercentages","percentageList","twoDimPercentages","subLabel","subLabelDisplayValue","subLabelsHolder","subLabelsHTML","generateLegendBackground","querySelector","HTMLElement","d","h","w","valueSet","sum","total","svg","path","defs","gradientName","gradient","numberOfColors","offset","fill","stroke","valuesNum","getCrossAxisPoints","fillMode","applyGradient","clientWidth","clientHeight","paths","getMainAxisPoints","cross","next","m","getSVG","querySelectorAll","getPathDefinitions","definition","makeSVG","addLabels","addSubLabels","drawPaths","makeVertical","makeHorizontal","gradients","gradientMakeVertical","gradientMakeHorizontal","prototype","updateHeight","updateWidth","updateData","EditFunnel","funnelId","actionsLoading","htmlType","People","peopleLoading","action_id","Funnel","funnelLoading","stepsWithCountLoading"],"mappings":"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","file":"funnel.js","sourcesContent":["import React from 'react'\nimport api from './api'\nimport { toast } from 'react-toastify'\nimport PropTypes from 'prop-types'\nimport { Spin } from 'antd'\n\nexport function uuid() {\n    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n        (c ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))).toString(16)\n    )\n}\n\nexport let toParams = obj => {\n    let handleVal = val => {\n        if (val._isAMomentObject) return encodeURIComponent(val.format('YYYY-MM-DD'))\n        val = typeof val === 'object' ? JSON.stringify(val) : val\n        return encodeURIComponent(val)\n    }\n    return Object.entries(obj)\n        .filter(([key, val]) => val)\n        .map(([key, val]) => `${key}=${handleVal(val)}`)\n        .join('&')\n}\nexport let fromParams = () =>\n    window.location.search != ''\n        ? window.location.search\n              .slice(1)\n              .split('&')\n              .reduce((a, b) => {\n                  b = b.split('=')\n                  a[b[0]] = decodeURIComponent(b[1])\n                  return a\n              }, {})\n        : {}\n\nexport let colors = ['success', 'secondary', 'warning', 'primary', 'danger', 'info', 'dark', 'light']\nexport let percentage = division =>\n    division\n        ? division.toLocaleString(undefined, {\n              style: 'percent',\n              maximumFractionDigits: 2,\n          })\n        : ''\n\nexport let Loading = () => (\n    <div className=\"loading-overlay\">\n        <div></div>\n        <Spin />\n    </div>\n)\n\nexport const TableRowLoading = ({ colSpan = 1, asOverlay = false }) => (\n    <tr className={asOverlay ? 'loading-overlay over-table' : ''}>\n        <td colSpan={colSpan} style={{ padding: 50, textAlign: 'center' }}>\n            <Spin />\n        </td>\n    </tr>\n)\n\nexport let CloseButton = props => {\n    return (\n        <span {...props} className={'close cursor-pointer ' + props.className} style={{ ...props.style }}>\n            <span aria-hidden=\"true\">&times;</span>\n        </span>\n    )\n}\n\nexport function Card(props) {\n    return (\n        <div {...props} className={'card ' + props.className} style={props.style} title=\"\">\n            {props.title && <div className=\"card-header\">{props.title}</div>}\n            {props.children}\n        </div>\n    )\n}\n\nexport let DeleteWithUndo = props => {\n    let deleteWithUndo = undo => {\n        api.update('api/' + props.endpoint + '/' + props.object.id, {\n            ...props.object,\n            deleted: undo ? false : true,\n        }).then(() => {\n            props.callback()\n            let response = (\n                <div>\n                    {!undo ? (\n                        <span>\n                            \"<strong>{props.object.name}</strong>\" deleted.{' '}\n                            <a\n                                href=\"#\"\n                                onClick={e => {\n                                    e.preventDefault()\n                                    deleteWithUndo(true)\n                                }}\n                            >\n                                Click here to undo\n                            </a>\n                        </span>\n                    ) : (\n                        <span>Delete un-done</span>\n                    )}\n                </div>\n            )\n            toast(response, { toastId: 'delete-item-' + props.object.id })\n        })\n    }\n\n    return (\n        <a\n            href=\"#\"\n            onClick={e => {\n                e.preventDefault()\n                deleteWithUndo()\n            }}\n            className={props.className}\n            style={props.style}\n        >\n            {props.children}\n        </a>\n    )\n}\nDeleteWithUndo.propTypes = {\n    endpoint: PropTypes.string.isRequired,\n    object: PropTypes.shape({\n        name: PropTypes.string.isRequired,\n        id: PropTypes.number.isRequired,\n    }).isRequired,\n    className: PropTypes.string,\n    style: PropTypes.object,\n}\n\nexport let selectStyle = {\n    control: base => ({\n        ...base,\n        height: 31,\n        minHeight: 31,\n    }),\n    indicatorsContainer: base => ({\n        ...base,\n        height: 31,\n    }),\n    input: base => ({\n        ...base,\n        paddingBottom: 0,\n        paddingTop: 0,\n        margin: 0,\n        opacity: 1,\n    }),\n    valueContainer: base => ({\n        ...base,\n        padding: '0 8px',\n        marginTop: -2,\n    }),\n    option: base => ({\n        ...base,\n        padding: '2px 15px',\n    }),\n}\n\nexport let debounce = (func, wait, immediate) => {\n    var timeout\n    return function() {\n        var context = this,\n            args = arguments\n        var later = function() {\n            timeout = null\n            if (!immediate) func.apply(context, args)\n        }\n        var callNow = immediate && !timeout\n        clearTimeout(timeout)\n        timeout = setTimeout(later, wait)\n        if (callNow) func.apply(context, args)\n    }\n}\n\nexport const capitalizeFirstLetter = string => {\n    return string.charAt(0).toUpperCase() + string.slice(1)\n}\n\nexport const operatorMap = {\n    exact: '= equals',\n    is_not: \" doesn't equal\",\n    icontains: ' contains',\n    not_icontains: \" doesn't contain\",\n    gt: '> greater than',\n    lt: '< lower than',\n}\n\nconst operatorEntries = Object.entries(operatorMap).reverse()\n\nexport const formatFilterName = str => {\n    for (let [key, value] of operatorEntries) {\n        if (str.includes(key)) return str.replace('__' + key, '') + ` ${value.split(' ')[0]} `\n    }\n    return str + ` ${operatorMap['exact'].split(' ')[0]} `\n}\n\nexport const deletePersonData = (person, callback) => {\n    window.confirm('Are you sure you want to delete this user? This cannot be undone') &&\n        api.delete('api/person/' + person.id).then(() => {\n            toast('Person succesfully deleted.')\n            if (callback) callback()\n        })\n}\n\nexport const objectsEqual = (obj1, obj2) => JSON.stringify(obj1) === JSON.stringify(obj2)\n","import { kea } from 'kea'\n\nimport api from 'lib/api'\nimport { objectsEqual, toParams as toAPIParams } from 'lib/utils'\nimport { actionsModel } from '~/models/actionsModel'\nimport { userLogic } from 'scenes/userLogic'\nimport { router } from 'kea-router'\n\nexport const EntityTypes = {\n    ACTIONS: 'actions',\n    EVENTS: 'events',\n    NEW_ENTITY: 'new_entity',\n}\n\nexport const disableMinuteFor = {\n    dStart: false,\n    '-1d': false,\n    '-7d': true,\n    '-14d': true,\n    '-30d': true,\n    '-90d': true,\n    mStart: true,\n    '-1mStart': true,\n    yStart: true,\n    all: true,\n}\n\nexport const disableHourFor = {\n    dStart: false,\n    '-1d': false,\n    '-7d': false,\n    '-14d': false,\n    '-30d': false,\n    '-90d': true,\n    mStart: false,\n    '-1mStart': false,\n    yStart: true,\n    all: true,\n}\n\nexport const ViewType = {\n    FILTERS: 'FILTERS',\n    SESSIONS: 'SESSIONS',\n}\n\nfunction cleanFilters(filters) {\n    return {\n        ...filters,\n        interval: autocorrectInterval(filters),\n        display: filters.session && filters.session === 'dist' ? 'ActionsTable' : filters.display,\n        actions: Array.isArray(filters.actions) ? filters.actions : undefined,\n        events: Array.isArray(filters.events) ? filters.events : undefined,\n        properties: filters.properties || {},\n    }\n}\n\nfunction filterClientSideParams(filters) {\n    const {\n        people_day: _skip_this_one,\n        people_action: _skip_this_too,\n        stickiness_days: __and_this,\n        ...newFilters\n    } = filters\n\n    return newFilters\n}\n\nfunction autocorrectInterval({ date_from, interval }) {\n    if (!interval) return 'day' // undefined/uninitialized\n\n    const minute_disabled = disableMinuteFor[date_from] && interval === 'minute'\n    const hour_disabled = disableHourFor[date_from] && interval === 'hour'\n\n    if (minute_disabled) {\n        return 'hour'\n    } else if (hour_disabled) {\n        return 'day'\n    } else {\n        return interval\n    }\n}\n\n// props:\n// - dashboardItemId\n// - filters\nexport const trendsLogic = kea({\n    key: props => props.dashboardItemId || 'all_trends',\n\n    connect: {\n        values: [userLogic, ['eventNames'], actionsModel, ['actions']],\n    },\n\n    loaders: ({ values }) => ({\n        results: {\n            loadResults: async () => {\n                if (values.activeView === ViewType.SESSIONS) {\n                    return await api.get('api/event/sessions/?' + toAPIParams(filterClientSideParams(values.filters)))\n                }\n                return await api.get('api/action/trends/?' + toAPIParams(filterClientSideParams(values.filters)))\n            },\n        },\n    }),\n\n    actions: () => ({\n        setFilters: (filters, mergeFilters = true, fromUrl = false) => ({ filters, mergeFilters, fromUrl }),\n        setDisplay: display => ({ display }),\n\n        loadPeople: (action, day, breakdown_value) => ({ action, day, breakdown_value }),\n        setShowingPeople: isShowing => ({ isShowing }),\n        setPeople: (people, count, action, day, breakdown_value) => ({ people, count, action, day, breakdown_value }),\n        setActiveView: type => ({ type }),\n        setCachedUrl: (type, url) => ({ type, url }),\n    }),\n\n    reducers: ({ actions, props }) => ({\n        filters: [\n            props.dashboardItemId ? props.filters : state => cleanFilters(router.selectors.searchParams(state)),\n            {\n                [actions.setFilters]: (state, { filters, mergeFilters }) => {\n                    return cleanFilters({\n                        ...(mergeFilters ? state : {}),\n                        ...filters,\n                    })\n                },\n            },\n        ],\n        people: [\n            null,\n            {\n                [actions.setFilters]: () => null,\n                [actions.setPeople]: (_, people) => people,\n            },\n        ],\n        cachedUrls: [\n            {},\n            {\n                [actions.setCachedUrl]: (state, { type, url }) => ({ ...state, [type]: url }),\n            },\n        ],\n        showingPeople: [\n            false,\n            {\n                [actions.loadPeople]: () => true,\n                [actions.setShowingPeople]: (_, { isShowing }) => isShowing,\n            },\n        ],\n    }),\n\n    selectors: ({ selectors }) => ({\n        activeView: [() => [selectors.filters], filters => (filters.session ? ViewType.SESSIONS : ViewType.FILTERS)],\n        peopleAction: [\n            () => [selectors.filters, selectors.actions],\n            (filters, actions) =>\n                filters.people_action ? actions.find(a => a.id === parseInt(filters.people_action)) : null,\n        ],\n        peopleDay: [() => [selectors.filters], filters => filters.people_day],\n    }),\n\n    listeners: ({ actions, values }) => ({\n        [actions.setDisplay]: async ({ display }) => {\n            actions.setFilters({ display })\n        },\n        [actions.loadPeople]: async ({ action, day, breakdown_value }, breakpoint) => {\n            const params = filterClientSideParams({\n                ...values.filters,\n                entityId: action.id,\n                type: action.type,\n            })\n\n            if (values.filters.shown_as === 'Stickiness') {\n                params.stickiness_days = day\n            } else {\n                params.date_from = day\n                params.date_to = day\n            }\n            if (breakdown_value) {\n                params.properties = { ...params.properties, [params.breakdown]: breakdown_value }\n            }\n\n            const filterParams = toAPIParams(params)\n            actions.setPeople(null, null, action, day, breakdown_value)\n            const people = await api.get(`api/action/people/?include_last_event=1&${filterParams}`)\n            breakpoint()\n            actions.setPeople(people[0]?.people, people[0]?.count, action, day, breakdown_value)\n        },\n    }),\n\n    actionToUrl: ({ actions, values, props }) => ({\n        [actions.setFilters]: ({ fromUrl }) => {\n            if (props.dashboardItemId) {\n                return // don't use the URL if on the dashboard\n            }\n            if (!fromUrl) {\n                return ['/trends', values.filters]\n            }\n        },\n        [actions.setActiveView]: ({ type }) => {\n            if (props.dashboardItemId) {\n                return // don't use the URL if on the dashboard\n            }\n            actions.setCachedUrl(values.activeView, window.location.pathname + window.location.search)\n            const cachedUrl = values.cachedUrls[type]\n            if (cachedUrl) {\n                return cachedUrl\n            }\n            return ['/trends', type === ViewType.SESSIONS ? { session: 'avg' } : {}]\n        },\n    }),\n\n    urlToAction: ({ actions, values, props }) => ({\n        '/trends': (_, searchParams) => {\n            if (props.dashboardItemId) {\n                return // don't use the URL if on the dashboard\n            }\n\n            const cleanSearchParams = cleanFilters(searchParams)\n\n            // opening /trends without any params, just open $pageview, $screen or the first random event\n            if (Object.keys(searchParams).length === 0 && values.eventNames && values.eventNames[0]) {\n                const event = values.eventNames.includes('$pageview')\n                    ? '$pageview'\n                    : values.eventNames.includes('$screen')\n                    ? '$screen'\n                    : values.eventNames[0]\n\n                cleanSearchParams[EntityTypes.EVENTS] = [\n                    {\n                        id: event,\n                        name: event,\n                        type: EntityTypes.EVENTS,\n                        order: 0,\n                    },\n                ]\n            }\n\n            if (!objectsEqual(cleanSearchParams, values.filters)) {\n                actions.setFilters(cleanSearchParams, false, true)\n            }\n        },\n    }),\n})\n","import { kea } from 'kea'\nimport api from 'lib/api'\n\nconst actionContains = (action, event) => {\n    return action.steps.filter(step => step.event == event).length > 0\n}\n\nexport const actionsModel = kea({\n    loaders: () => ({\n        actions: {\n            __default: [],\n            loadActions: async () => {\n                const response = await api.get('api/action')\n                return response.results\n            },\n        },\n    }),\n    selectors: ({ selectors }) => ({\n        actionsGrouped: [\n            () => [selectors.actions],\n            actions => {\n                let data = [\n                    { label: 'Autocapture', options: [] },\n                    { label: 'Event', options: [] },\n                    { label: 'Pageview', options: [] },\n                ]\n                actions.forEach(action => {\n                    let format = { label: action.name, value: action.id }\n                    if (actionContains(action, '$autocapture')) data[0].options.push(format)\n                    if (actionContains(action, '$pageview')) data[2].options.push(format)\n                    if (!actionContains(action, '$autocapture') && !actionContains(action, '$pageview'))\n                        data[1].options.push(format)\n                })\n                return data\n            },\n        ],\n    }),\n\n    events: ({ actions }) => ({\n        afterMount: actions.loadActions,\n    }),\n})\n","import React, { Component } from 'react'\nimport api from '../../api'\nimport AsyncCreatableSelect from 'react-select/async-creatable/dist/react-select.esm'\nimport { selectStyle, debounce } from '../../utils'\nimport PropTypes from 'prop-types'\n\nexport class PropertyValue extends Component {\n    constructor(props) {\n        super(props)\n        this.state = { input: props.value }\n        this.loadPropertyValues = debounce(this.loadPropertyValues.bind(this), 250)\n        this.ref = React.createRef()\n    }\n    loadPropertyValues(value, callback) {\n        let key = this.props.propertyKey.split('__')[0]\n        api.get('api/' + this.props.endpoint + '/values/?key=' + key + (value ? '&value=' + value : '')).then(\n            propValues =>\n                callback(\n                    propValues.map(property => ({\n                        label: property.name ? property.name : '(empty)',\n                        value: property.name,\n                    }))\n                )\n        )\n    }\n    render() {\n        let { propertyKey, onSet, value } = this.props\n        let { isEditing, input } = this.state\n        return (\n            <span ref={this.ref} className=\"property-value\">\n                <AsyncCreatableSelect\n                    loadOptions={this.loadPropertyValues}\n                    defaultOptions={true}\n                    cacheOptions\n                    formatCreateLabel={inputValue => 'Specify: ' + inputValue}\n                    allowCreateWhileLoading={true}\n                    createOptionPosition=\"first\"\n                    key={propertyKey} // forces a reload of the component when the property changes\n                    placeholder=\"Property value\"\n                    style={{ width: 200 }}\n                    value={{ label: value, value: value }}\n                    onChange={out => {\n                        onSet(propertyKey, out.value)\n                        this.setState({ input: out.value })\n                        this.select.blur()\n                    }}\n                    autoFocus={!value}\n                    styles={selectStyle}\n                    ref={ref => {\n                        this.select = ref\n                    }}\n                    // This is a series of hacks to make the text editable\n                    inputValue={isEditing ? this.state.input : ''}\n                    onFocus={() => this.setState({ isEditing: true })}\n                    onInputChange={(input, actionMeta) => {\n                        if (actionMeta.action === 'input-change') {\n                            this.setState({ input })\n                            return input\n                        }\n                        return this.state.input\n                    }}\n                />\n            </span>\n        )\n    }\n}\nPropertyValue.propTypes = {\n    propertyKey: PropTypes.string.isRequired,\n    value: PropTypes.any.isRequired,\n    onSet: PropTypes.func.isRequired,\n}\n","import React from 'react'\nimport Select from 'react-select'\nimport { selectStyle, operatorMap } from 'lib/utils'\nimport { PropertyValue } from './PropertyValue'\nimport { useValues, useActions } from 'kea'\n\nconst operatorOptions = Object.entries(operatorMap).map(([key, value]) => ({\n    label: value,\n    value: key,\n}))\n\nexport function PropertyFilter({ index, endpoint, onComplete, logic }) {\n    const { properties, filters } = useValues(logic)\n    const { setFilter, remove } = useActions(logic)\n    let item = filters[index]\n    let key = Object.keys(item)[0] ? Object.keys(item)[0].split('__') : []\n    let value = Object.values(item)[0]\n    return (\n        <div className=\"row\" style={{ margin: '0.5rem -15px', minWidth: key[0] ? 700 : 200 }}>\n            {properties && (\n                <div className={key[0] ? 'col-4' : 'col'}>\n                    <Select\n                        options={properties}\n                        value={[{ label: key[0], value: key[0] }]}\n                        isLoading={!properties}\n                        placeholder=\"Property key\"\n                        onChange={item =>\n                            setFilter(\n                                index,\n                                item.value + (key[1] ? '__' + key[1] : ''),\n                                item.value !== key[0] ? '' : value\n                            )\n                        }\n                        styles={selectStyle}\n                        autoFocus={!key[0]}\n                        openMenuOnFocus={true}\n                    />\n                </div>\n            )}\n\n            {key[0] && (\n                <div className=\"col-3 pl-0\">\n                    <Select\n                        options={operatorOptions}\n                        style={{ width: 200 }}\n                        value={[\n                            {\n                                label: operatorMap[key[1]] || '= equals',\n                                value: key[1],\n                            },\n                        ]}\n                        placeholder=\"Property key\"\n                        onChange={operator => setFilter(index, key[0] + '__' + operator.value, value)}\n                        styles={selectStyle}\n                    />\n                </div>\n            )}\n            {key[0] && (\n                <div className=\"col-5 pl-0\">\n                    <PropertyValue\n                        endpoint={endpoint}\n                        key={Object.keys(item)[0]}\n                        propertyKey={Object.keys(item)[0]}\n                        value={value}\n                        onSet={(key, value) => {\n                            onComplete()\n                            setFilter(index, key, value)\n                        }}\n                    />\n                    {(key[1] === 'gt' || key[1] === 'lt') && isNaN(value) && (\n                        <p className=\"text-danger\">Value needs to be a number. Try \"equals\" or \"contains\" instead.</p>\n                    )}\n                </div>\n            )}\n        </div>\n    )\n}\n","import { kea } from 'kea'\nimport api from '../../../lib/api'\nimport { userLogic } from 'scenes/userLogic'\nimport { objectsEqual } from 'lib/utils'\nimport { router } from 'kea-router'\n\nexport const propertyFilterLogic = kea({\n    key: props => props.pageKey,\n\n    actions: () => ({\n        loadEventProperties: true,\n        setProperties: properties => ({ properties }),\n        update: filters => ({ filters }),\n        setFilter: (index, key, value) => ({ index, key, value }),\n        setFilters: filters => ({ filters }),\n        newFilter: true,\n        remove: index => ({ index }),\n    }),\n\n    loaders: () => ({\n        properties: {\n            loadPeopleProperties: async () => {\n                return (await api.get('api/person/properties')).map(property => ({\n                    label: property.name,\n                    value: property.name,\n                }))\n            },\n        },\n    }),\n\n    reducers: ({ actions, props }) => ({\n        properties: [\n            [],\n            {\n                [actions.loadPeoplePropertiesSuccess]: (_, { properties }) => properties,\n                [actions.setProperties]: (_, { properties }) => properties,\n            },\n        ],\n        filters: [\n            props.propertyFilters\n                ? Object.entries(props.propertyFilters).map(([key, value]) => ({ [key]: value }))\n                : [],\n            {\n                [actions.setFilter]: (state, { index, key, value }) => {\n                    const newFilters = [...state]\n                    newFilters[index] = { [key]: value }\n                    return newFilters\n                },\n                [actions.setFilters]: (_, { filters }) => filters,\n                [actions.newFilter]: state => {\n                    return [...state, {}]\n                },\n                [actions.remove]: (state, { index }) => {\n                    const newState = state.filter((_, i) => i !== index)\n                    if (newState.length === 0) {\n                        return [{}]\n                    }\n                    if (Object.keys(newState[newState.length - 1]).length !== 0) {\n                        return [...newState, {}]\n                    }\n                    return newState\n                },\n            },\n        ],\n    }),\n\n    listeners: ({ actions, props, values }) => ({\n        // Only send update if value is set to something\n        [actions.setFilter]: ({ value }) => value && actions.update(),\n        [actions.remove]: () => actions.update(),\n        [actions.update]: () => {\n            if (props.onChange) {\n                if (values.filters.length === 0) {\n                    actions.newFilter()\n                    return props.onChange({})\n                }\n                if (Object.keys(values.filters[values.filters.length - 1]).length !== 0) actions.newFilter()\n                let dict = values.filters.reduce((result, item) => ({ ...result, ...item }))\n                props.onChange(dict)\n            } else {\n                const { filters } = values\n                const { properties: _, ...searchParams } = router.values.searchParams\n                const { pathname } = router.values.location\n\n                if (filters.filter(f => Object.keys(f).length > 0).length > 0) {\n                    searchParams.properties = filters.reduce((result, item) => ({ ...result, ...item }))\n                }\n\n                if (!objectsEqual(router.values.searchParams, searchParams)) {\n                    router.actions.push(pathname, searchParams)\n                }\n            }\n        },\n    }),\n\n    urlToAction: ({ actions, values, props }) => ({\n        '*': (_, { properties }) => {\n            if (props.onChange) {\n                return\n            }\n\n            let filters\n            try {\n                filters = values.filters\n            } catch (error) {\n                // since this is a catch-all route, this code might run during or after the logic was unmounted\n                // if we have an error accessing the filter value, the logic is gone and we should return\n                return\n            }\n\n            if (!objectsEqual(properties || {}, filters)) {\n                const mappedFilters = Object.entries(properties || {}).map(([key, value]) => ({ [key]: value }))\n                actions.setFilters([...mappedFilters, {}])\n            }\n        },\n    }),\n\n    events: ({ actions, props }) => ({\n        afterMount: () => {\n            actions.newFilter()\n            if (props.endpoint === 'person') {\n                actions.loadPeopleProperties()\n            } else {\n                actions.setProperties(userLogic.values.eventProperties)\n            }\n        },\n    }),\n})\n","import React, { useState } from 'react'\nimport { PropertyFilter } from './PropertyFilter'\nimport { Button } from 'antd'\nimport { useValues, useActions } from 'kea'\nimport { propertyFilterLogic } from './propertyFilterLogic'\nimport { Popover, Row } from 'antd'\nimport { CloseButton, formatFilterName } from 'lib/utils'\n\nfunction FilterRow({ endpoint, item, index, filters, logic }) {\n    const { remove } = useActions(logic)\n    let [open, setOpen] = useState(false)\n\n    let handleVisibleChange = visible => {\n        if (!visible && Object.keys(item).length >= 0 && !item[Object.keys(item)[0]]) {\n            remove(index)\n        }\n        setOpen(visible)\n    }\n\n    return (\n        <Row align=\"middle\" className=\"mt-2 mb-2\">\n            <Popover\n                trigger=\"click\"\n                onVisibleChange={handleVisibleChange}\n                defaultVisible={false}\n                visible={open}\n                placement=\"bottomLeft\"\n                content={\n                    <PropertyFilter\n                        key={index}\n                        index={index}\n                        endpoint={endpoint || 'event'}\n                        onComplete={() => setOpen(false)}\n                        logic={logic}\n                    />\n                }\n            >\n                {Object.keys(item).length !== 0 ? (\n                    <Button type=\"primary\" shape=\"round\" style={{ maxWidth: '85%' }}>\n                        <span style={{ width: '100%', overflow: 'hidden', textOverflow: 'ellipsis' }}>\n                            {formatFilterName(Object.keys(item)[0]) + item[Object.keys(item)[0]]}\n                        </span>\n                    </Button>\n                ) : (\n                    <Button type=\"default\" shape=\"round\">\n                        {'New Filter'}\n                    </Button>\n                )}\n            </Popover>\n            {index !== filters.length - 1 && (\n                <CloseButton\n                    className=\"ml-1\"\n                    onClick={() => {\n                        remove(index)\n                    }}\n                    style={{ cursor: 'pointer', float: 'none' }}\n                />\n            )}\n        </Row>\n    )\n}\n\nexport function PropertyFilters({ endpoint, propertyFilters, className, style, onChange, pageKey }) {\n    const logic = propertyFilterLogic({ propertyFilters, endpoint, onChange, pageKey })\n    const { filters } = useValues(logic)\n\n    return (\n        <div\n            className={className || 'col-8'}\n            style={{\n                padding: 0,\n                marginBottom: '2rem',\n                display: 'inline',\n                style,\n            }}\n        >\n            <div className=\"column\">\n                {filters &&\n                    filters.map((item, index) => {\n                        return (\n                            <FilterRow\n                                key={index === filters.length - 1 ? index : `${index}_${Object.keys(item)[0]}`}\n                                logic={logic}\n                                item={item}\n                                index={index}\n                                filters={filters}\n                                endpoint={endpoint}\n                            />\n                        )\n                    })}\n            </div>\n        </div>\n    )\n}\n","var map = {\n\t\"./af\": 229,\n\t\"./af.js\": 229,\n\t\"./ar\": 230,\n\t\"./ar-dz\": 231,\n\t\"./ar-dz.js\": 231,\n\t\"./ar-kw\": 232,\n\t\"./ar-kw.js\": 232,\n\t\"./ar-ly\": 233,\n\t\"./ar-ly.js\": 233,\n\t\"./ar-ma\": 234,\n\t\"./ar-ma.js\": 234,\n\t\"./ar-sa\": 235,\n\t\"./ar-sa.js\": 235,\n\t\"./ar-tn\": 236,\n\t\"./ar-tn.js\": 236,\n\t\"./ar.js\": 230,\n\t\"./az\": 237,\n\t\"./az.js\": 237,\n\t\"./be\": 238,\n\t\"./be.js\": 238,\n\t\"./bg\": 239,\n\t\"./bg.js\": 239,\n\t\"./bm\": 240,\n\t\"./bm.js\": 240,\n\t\"./bn\": 241,\n\t\"./bn-bd\": 242,\n\t\"./bn-bd.js\": 242,\n\t\"./bn.js\": 241,\n\t\"./bo\": 243,\n\t\"./bo.js\": 243,\n\t\"./br\": 244,\n\t\"./br.js\": 244,\n\t\"./bs\": 245,\n\t\"./bs.js\": 245,\n\t\"./ca\": 246,\n\t\"./ca.js\": 246,\n\t\"./cs\": 247,\n\t\"./cs.js\": 247,\n\t\"./cv\": 248,\n\t\"./cv.js\": 248,\n\t\"./cy\": 249,\n\t\"./cy.js\": 249,\n\t\"./da\": 250,\n\t\"./da.js\": 250,\n\t\"./de\": 251,\n\t\"./de-at\": 252,\n\t\"./de-at.js\": 252,\n\t\"./de-ch\": 253,\n\t\"./de-ch.js\": 253,\n\t\"./de.js\": 251,\n\t\"./dv\": 254,\n\t\"./dv.js\": 254,\n\t\"./el\": 255,\n\t\"./el.js\": 255,\n\t\"./en-au\": 256,\n\t\"./en-au.js\": 256,\n\t\"./en-ca\": 257,\n\t\"./en-ca.js\": 257,\n\t\"./en-gb\": 258,\n\t\"./en-gb.js\": 258,\n\t\"./en-ie\": 259,\n\t\"./en-ie.js\": 259,\n\t\"./en-il\": 260,\n\t\"./en-il.js\": 260,\n\t\"./en-in\": 261,\n\t\"./en-in.js\": 261,\n\t\"./en-nz\": 262,\n\t\"./en-nz.js\": 262,\n\t\"./en-sg\": 263,\n\t\"./en-sg.js\": 263,\n\t\"./eo\": 264,\n\t\"./eo.js\": 264,\n\t\"./es\": 265,\n\t\"./es-do\": 266,\n\t\"./es-do.js\": 266,\n\t\"./es-mx\": 267,\n\t\"./es-mx.js\": 267,\n\t\"./es-us\": 268,\n\t\"./es-us.js\": 268,\n\t\"./es.js\": 265,\n\t\"./et\": 269,\n\t\"./et.js\": 269,\n\t\"./eu\": 270,\n\t\"./eu.js\": 270,\n\t\"./fa\": 271,\n\t\"./fa.js\": 271,\n\t\"./fi\": 272,\n\t\"./fi.js\": 272,\n\t\"./fil\": 273,\n\t\"./fil.js\": 273,\n\t\"./fo\": 274,\n\t\"./fo.js\": 274,\n\t\"./fr\": 275,\n\t\"./fr-ca\": 276,\n\t\"./fr-ca.js\": 276,\n\t\"./fr-ch\": 277,\n\t\"./fr-ch.js\": 277,\n\t\"./fr.js\": 275,\n\t\"./fy\": 278,\n\t\"./fy.js\": 278,\n\t\"./ga\": 279,\n\t\"./ga.js\": 279,\n\t\"./gd\": 280,\n\t\"./gd.js\": 280,\n\t\"./gl\": 281,\n\t\"./gl.js\": 281,\n\t\"./gom-deva\": 282,\n\t\"./gom-deva.js\": 282,\n\t\"./gom-latn\": 283,\n\t\"./gom-latn.js\": 283,\n\t\"./gu\": 284,\n\t\"./gu.js\": 284,\n\t\"./he\": 285,\n\t\"./he.js\": 285,\n\t\"./hi\": 286,\n\t\"./hi.js\": 286,\n\t\"./hr\": 287,\n\t\"./hr.js\": 287,\n\t\"./hu\": 288,\n\t\"./hu.js\": 288,\n\t\"./hy-am\": 289,\n\t\"./hy-am.js\": 289,\n\t\"./id\": 290,\n\t\"./id.js\": 290,\n\t\"./is\": 291,\n\t\"./is.js\": 291,\n\t\"./it\": 292,\n\t\"./it-ch\": 293,\n\t\"./it-ch.js\": 293,\n\t\"./it.js\": 292,\n\t\"./ja\": 294,\n\t\"./ja.js\": 294,\n\t\"./jv\": 295,\n\t\"./jv.js\": 295,\n\t\"./ka\": 296,\n\t\"./ka.js\": 296,\n\t\"./kk\": 297,\n\t\"./kk.js\": 297,\n\t\"./km\": 298,\n\t\"./km.js\": 298,\n\t\"./kn\": 299,\n\t\"./kn.js\": 299,\n\t\"./ko\": 300,\n\t\"./ko.js\": 300,\n\t\"./ku\": 301,\n\t\"./ku.js\": 301,\n\t\"./ky\": 302,\n\t\"./ky.js\": 302,\n\t\"./lb\": 303,\n\t\"./lb.js\": 303,\n\t\"./lo\": 304,\n\t\"./lo.js\": 304,\n\t\"./lt\": 305,\n\t\"./lt.js\": 305,\n\t\"./lv\": 306,\n\t\"./lv.js\": 306,\n\t\"./me\": 307,\n\t\"./me.js\": 307,\n\t\"./mi\": 308,\n\t\"./mi.js\": 308,\n\t\"./mk\": 309,\n\t\"./mk.js\": 309,\n\t\"./ml\": 310,\n\t\"./ml.js\": 310,\n\t\"./mn\": 311,\n\t\"./mn.js\": 311,\n\t\"./mr\": 312,\n\t\"./mr.js\": 312,\n\t\"./ms\": 313,\n\t\"./ms-my\": 314,\n\t\"./ms-my.js\": 314,\n\t\"./ms.js\": 313,\n\t\"./mt\": 315,\n\t\"./mt.js\": 315,\n\t\"./my\": 316,\n\t\"./my.js\": 316,\n\t\"./nb\": 317,\n\t\"./nb.js\": 317,\n\t\"./ne\": 318,\n\t\"./ne.js\": 318,\n\t\"./nl\": 319,\n\t\"./nl-be\": 320,\n\t\"./nl-be.js\": 320,\n\t\"./nl.js\": 319,\n\t\"./nn\": 321,\n\t\"./nn.js\": 321,\n\t\"./oc-lnc\": 322,\n\t\"./oc-lnc.js\": 322,\n\t\"./pa-in\": 323,\n\t\"./pa-in.js\": 323,\n\t\"./pl\": 324,\n\t\"./pl.js\": 324,\n\t\"./pt\": 325,\n\t\"./pt-br\": 326,\n\t\"./pt-br.js\": 326,\n\t\"./pt.js\": 325,\n\t\"./ro\": 327,\n\t\"./ro.js\": 327,\n\t\"./ru\": 328,\n\t\"./ru.js\": 328,\n\t\"./sd\": 329,\n\t\"./sd.js\": 329,\n\t\"./se\": 330,\n\t\"./se.js\": 330,\n\t\"./si\": 331,\n\t\"./si.js\": 331,\n\t\"./sk\": 332,\n\t\"./sk.js\": 332,\n\t\"./sl\": 333,\n\t\"./sl.js\": 333,\n\t\"./sq\": 334,\n\t\"./sq.js\": 334,\n\t\"./sr\": 335,\n\t\"./sr-cyrl\": 336,\n\t\"./sr-cyrl.js\": 336,\n\t\"./sr.js\": 335,\n\t\"./ss\": 337,\n\t\"./ss.js\": 337,\n\t\"./sv\": 338,\n\t\"./sv.js\": 338,\n\t\"./sw\": 339,\n\t\"./sw.js\": 339,\n\t\"./ta\": 340,\n\t\"./ta.js\": 340,\n\t\"./te\": 341,\n\t\"./te.js\": 341,\n\t\"./tet\": 342,\n\t\"./tet.js\": 342,\n\t\"./tg\": 343,\n\t\"./tg.js\": 343,\n\t\"./th\": 344,\n\t\"./th.js\": 344,\n\t\"./tk\": 345,\n\t\"./tk.js\": 345,\n\t\"./tl-ph\": 346,\n\t\"./tl-ph.js\": 346,\n\t\"./tlh\": 347,\n\t\"./tlh.js\": 347,\n\t\"./tr\": 348,\n\t\"./tr.js\": 348,\n\t\"./tzl\": 349,\n\t\"./tzl.js\": 349,\n\t\"./tzm\": 350,\n\t\"./tzm-latn\": 351,\n\t\"./tzm-latn.js\": 351,\n\t\"./tzm.js\": 350,\n\t\"./ug-cn\": 352,\n\t\"./ug-cn.js\": 352,\n\t\"./uk\": 353,\n\t\"./uk.js\": 353,\n\t\"./ur\": 354,\n\t\"./ur.js\": 354,\n\t\"./uz\": 355,\n\t\"./uz-latn\": 356,\n\t\"./uz-latn.js\": 356,\n\t\"./uz.js\": 355,\n\t\"./vi\": 357,\n\t\"./vi.js\": 357,\n\t\"./x-pseudo\": 358,\n\t\"./x-pseudo.js\": 358,\n\t\"./yo\": 359,\n\t\"./yo.js\": 359,\n\t\"./zh-cn\": 360,\n\t\"./zh-cn.js\": 360,\n\t\"./zh-hk\": 361,\n\t\"./zh-hk.js\": 361,\n\t\"./zh-mo\": 362,\n\t\"./zh-mo.js\": 362,\n\t\"./zh-tw\": 363,\n\t\"./zh-tw.js\": 363\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 375;","import React, { Component, useRef, useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Select, DatePicker, Button } from 'antd'\n\nimport moment from 'moment'\n\nlet dateMapping = {\n    Today: ['dStart'],\n    Yesterday: ['-1d', 'dStart'],\n    'Last week': ['-7d'],\n    'Last 2 weeks': ['-14d'],\n    'Last 30 days': ['-30d'],\n    'Last 90 days': ['-90d'],\n    'This month': ['mStart'],\n    'Previous month': ['-1mStart', '-1mEnd'],\n    'Year to date': ['yStart'],\n    'All time': ['all'],\n}\n\nlet isDate = /([0-9]{4}-[0-9]{2}-[0-9]{2})/\n\nexport class DateFilter extends Component {\n    static propTypes = {\n        onChange: PropTypes.func.isRequired,\n    }\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            rangeDateFrom: isDate.test(props.dateFrom) && moment(props.dateFrom).toDate(),\n            rangeDateTo: isDate.test(props.dateTo) && moment(props.dateTo).toDate(),\n            dateRangeOpen: false,\n            open: false,\n        }\n    }\n\n    onClickOutside = () => {\n        this.setState({\n            open: false,\n            dateRangeOpen: false,\n        })\n    }\n\n    setDate = (from_date, to_date) => {\n        this.props.onChange(from_date, to_date)\n    }\n\n    dateFilterToText(date_from, date_to) {\n        if (isDate.test(date_from)) return `${date_from} - ${date_to}`\n        if (moment.isMoment(date_from)) return `${date_from.format('YYYY-MM-DD')} - ${date_to.format('YYYY-MM-DD')}`\n        let name = 'Last 7 days'\n        Object.entries(dateMapping).map(([key, value]) => {\n            if (value[0] === date_from && value[1] === date_to) name = key\n        })[0]\n        return name\n    }\n\n    onChange = v => {\n        if (v === 'Date range') {\n            if (this.state.open) {\n                this.setState({ dateRangeOpen: true, open: false })\n            }\n        } else this.setDate(dateMapping[v][0], dateMapping[v][1])\n    }\n\n    onBlur = () => {\n        if (this.state.dateRangeOpen) return\n        this.setState({\n            open: false,\n            dateRangeOpen: false,\n        })\n    }\n\n    onClick = () => {\n        if (this.state.dateRangeOpen) return\n        this.setState({\n            open: !this.state.open,\n        })\n    }\n\n    dropdownOnClick = e => {\n        e.preventDefault()\n        this.setState({ dateRangeOpen: false, open: true })\n        document.getElementById('daterange_selector').focus()\n    }\n\n    onDateFromChange = date => this.setState({ rangeDateFrom: date })\n\n    onDateToChange = date => this.setState({ rangeDateTo: date })\n\n    onApplyClick = () => {\n        this.setState({\n            dateRangeOpen: false,\n            open: false,\n        })\n        this.props.onChange(\n            moment(this.state.rangeDateFrom).format('YYYY-MM-DD'),\n            moment(this.state.rangeDateTo).format('YYYY-MM-DD')\n        )\n    }\n\n    render() {\n        let { rangeDateFrom, rangeDateTo } = this.state\n        return (\n            <Select\n                bordered={false}\n                id=\"daterange_selector\"\n                value={this.dateFilterToText(this.props.dateFrom, this.props.dateTo)}\n                onChange={this.onChange}\n                style={{\n                    marginRight: 4,\n                    ...this.props.style,\n                }}\n                open={this.state.open || this.state.dateRangeOpen}\n                onBlur={this.onBlur}\n                onClick={this.onClick}\n                listHeight={400}\n                dropdownMatchSelectWidth={false}\n                dropdownRender={menu => {\n                    if (this.state.dateRangeOpen) {\n                        return (\n                            <DatePickerDropdown\n                                onClick={this.dropdownOnClick}\n                                onDateFromChange={this.onDateFromChange}\n                                onDateToChange={this.onDateToChange}\n                                onApplyClick={this.onApplyClick}\n                                onClickOutside={this.onClickOutside}\n                                rangeDateFrom={rangeDateFrom}\n                                rangeDateTo={rangeDateTo}\n                            />\n                        )\n                    } else if (this.state.open) {\n                        return menu\n                    }\n                }}\n            >\n                {[\n                    ...Object.entries(dateMapping).map(([key, value]) => {\n                        return (\n                            <Select.Option key={key} value={key}>\n                                {key}\n                            </Select.Option>\n                        )\n                    }),\n\n                    <Select.Option key={'Date range'} value={'Date range'}>\n                        {'Date range'}\n                    </Select.Option>,\n                ]}\n            </Select>\n        )\n    }\n}\n\nfunction DatePickerDropdown(props) {\n    const dropdownRef = useRef()\n    let [calendarOpen, setCalendarOpen] = useState(false)\n\n    let onClickOutside = event => {\n        if (!dropdownRef.current.contains(event.target) && !calendarOpen) {\n            props.onClickOutside()\n        }\n    }\n\n    useEffect(() => {\n        document.addEventListener('mousedown', onClickOutside)\n        return () => {\n            document.removeEventListener('mousedown', onClickOutside)\n        }\n    }, [calendarOpen])\n\n    return (\n        <div className=\"dropdown\" ref={dropdownRef}>\n            <a\n                style={{\n                    margin: '0 1rem',\n                    color: 'rgba(0, 0, 0, 0.2)',\n                    fontWeight: 700,\n                }}\n                href=\"#\"\n                onClick={props.onClick}\n            >\n                &lt;\n            </a>\n            <hr style={{ margin: '0.5rem 0' }} />\n            <div style={{ padding: '0 1rem' }}>\n                <label className=\"secondary\">From date</label>\n                <br />\n                <DatePicker\n                    popupStyle={{ zIndex: 999999 }}\n                    onOpenChange={open => {\n                        setCalendarOpen(open)\n                    }}\n                    defaultValue={\n                        props.rangeDateFrom\n                            ? moment.isMoment(props.rangeDateFrom)\n                                ? props.rangeDateFrom\n                                : moment(props.rangeDateFrom)\n                            : null\n                    }\n                    onChange={props.onDateFromChange}\n                />\n                <br />\n                <br />\n                <label className=\"secondary\">To date</label>\n                <br />\n                <DatePicker\n                    popupStyle={{ zIndex: 999999 }}\n                    onOpenChange={open => setCalendarOpen(open)}\n                    defaultValue={\n                        props.rangeDateTo\n                            ? moment.isMoment(props.rangeDateTo)\n                                ? props.rangeDateTo\n                                : moment(props.rangeDateTo)\n                            : null\n                    }\n                    onChange={props.onDateToChange}\n                />\n                <br />\n                <Button\n                    type=\"default\"\n                    disabled={!props.rangeDateTo || !props.rangeDateFrom}\n                    style={{ marginTop: '1rem', marginBottom: '1rem' }}\n                    onClick={props.onApplyClick}\n                >\n                    Apply filter\n                </Button>\n            </div>\n        </div>\n    )\n}\n","import { kea } from 'kea'\nimport api from 'lib/api'\nimport { toast } from 'react-toastify'\n\nexport const funnelLogic = kea({\n    key: props => props.id || 'new',\n\n    actions: () => ({\n        setFunnel: (funnel, update) => ({ funnel, update }),\n    }),\n\n    loaders: ({ props }) => ({\n        funnel: [\n            { filters: {} },\n            {\n                loadFunnel: async (id = props.id) => {\n                    return await api.get('api/funnel/' + id + '/?exclude_count=1')\n                },\n                updateFunnel: async funnel => {\n                    return await api.update('api/funnel/' + funnel.id, funnel)\n                },\n                createFunnel: async funnel => {\n                    return await api.create('api/funnel', funnel)\n                },\n            },\n        ],\n        stepsWithCount: {\n            loadStepsWithCount: async (id = props.id) => {\n                return (await api.get('api/funnel/' + id)).steps\n            },\n        },\n        people: {\n            loadPeople: async steps => {\n                return (await api.get('api/person/?id=' + steps[0].people.join(','))).results\n            },\n        },\n    }),\n\n    reducers: () => ({\n        funnel: {\n            setFunnel: (state, { funnel }) => ({\n                ...state,\n                ...funnel,\n                filters: { ...state.filters, ...funnel.filters },\n            }),\n        },\n    }),\n\n    selectors: ({ selectors }) => ({\n        peopleSorted: [\n            () => [selectors.stepsWithCount, selectors.people],\n            (steps, people) => {\n                if (!people) return null\n                const score = person => {\n                    return steps.reduce((val, step) => (step.people.indexOf(person.id) > -1 ? val + 1 : val), 0)\n                }\n                return people.sort((a, b) => score(b) - score(a))\n            },\n        ],\n        isStepsEmpty: [\n            () => [selectors.funnel],\n            funnel => {\n                return funnel && [...(funnel.filters.actions || []), ...(funnel.filters.events || [])].length === 0\n            },\n        ],\n    }),\n\n    listeners: ({ actions, values }) => ({\n        loadStepsWithCountSuccess: async () => {\n            actions.loadPeople(values.stepsWithCount)\n        },\n        setFunnel: ({ update }) => {\n            if (update) actions.updateFunnel(values.funnel)\n        },\n        updateFunnelSuccess: async ({ funnel }) => {\n            actions.loadStepsWithCount(funnel.id)\n            toast('Funnel saved!')\n        },\n        createFunnelSuccess: ({ funnel }) => {\n            actions.loadStepsWithCount(funnel.id)\n            toast('Funnel saved!')\n        },\n    }),\n\n    actionToUrl: () => ({\n        createFunnelSuccess: ({ funnel }) => `/funnel/${funnel.id}`,\n    }),\n\n    events: ({ actions, key }) => ({\n        afterMount: () => {\n            if (key === 'new') {\n                return\n            }\n            actions.loadFunnel()\n            actions.loadStepsWithCount()\n        },\n    }),\n})\n","import { kea } from 'kea'\nimport { actionsModel } from '~/models/actionsModel'\nimport { EntityTypes } from '../trendsLogic'\nimport { userLogic } from 'scenes/userLogic'\n\nfunction toLocalFilters(filters) {\n    return [\n        ...(filters[EntityTypes.ACTIONS] || []),\n        ...(filters[EntityTypes.EVENTS] || []),\n        ...(filters[EntityTypes.NEW_ENTITY] || []),\n    ]\n        .sort((a, b) => a.order - b.order)\n        .map((filter, order) => ({ ...filter, order }))\n}\n\nfunction toFilters(localFilters) {\n    const filters = localFilters.map((filter, index) => ({\n        ...filter,\n        order: index,\n    }))\n\n    return {\n        [EntityTypes.ACTIONS]: filters.filter(filter => filter.type === EntityTypes.ACTIONS),\n        [EntityTypes.EVENTS]: filters.filter(filter => filter.type === EntityTypes.EVENTS),\n        [EntityTypes.NEW_ENTITY]: filters.filter(filter => filter.type === EntityTypes.NEW_ENTITY),\n    }\n}\n\n// required props:\n// - filters\n// - setFilters\n// - typeKey\nexport const entityFilterLogic = kea({\n    key: props => props.typeKey,\n    connect: {\n        values: [userLogic, ['eventNames'], actionsModel, ['actions']],\n    },\n    actions: () => ({\n        selectFilter: filter => ({ filter }),\n        updateFilterMath: filter => ({\n            type: filter.type,\n            value: filter.value,\n            math: filter.math,\n            index: filter.index,\n        }),\n        updateFilter: filter => ({ type: filter.type, index: filter.index, value: filter.value }),\n        removeLocalFilter: filter => ({ value: filter.value, type: filter.type, index: filter.index }),\n        addFilter: true,\n        updateFilterProperty: filter => ({ properties: filter.properties, index: filter.index }),\n        setFilters: filters => ({ filters }),\n        setLocalFilters: filters => ({ filters }),\n    }),\n\n    reducers: ({ props }) => ({\n        selectedFilter: [\n            null,\n            {\n                selectFilter: (state, { filter }) => filter,\n            },\n        ],\n        localFilters: [\n            toLocalFilters(props.filters),\n            {\n                setLocalFilters: (_, { filters }) => toLocalFilters(filters),\n            },\n        ],\n    }),\n\n    selectors: ({ selectors }) => ({\n        entities: [\n            () => [selectors.eventNames, selectors.actions],\n            (events, actions) => {\n                return {\n                    [EntityTypes.ACTIONS]: actions,\n                    [EntityTypes.EVENTS]: events.map(event => ({ id: event, name: event })),\n                }\n            },\n        ],\n        filters: [() => [selectors.localFilters], localFilters => toFilters(localFilters)],\n    }),\n\n    listeners: ({ actions, values, props }) => ({\n        updateFilter: ({ type, index, value }) => {\n            actions.setFilters(\n                values.localFilters.map((filter, i) => (i === index ? { ...filter, id: value, type } : filter))\n            )\n            actions.selectFilter(null)\n        },\n        updateFilterProperty: ({ properties, index }) => {\n            actions.setFilters(\n                values.localFilters.map((filter, i) => (i === index ? { ...filter, properties } : filter))\n            )\n        },\n        updateFilterMath: ({ math, index }) => {\n            actions.setFilters(values.localFilters.map((filter, i) => (i === index ? { ...filter, math } : filter)))\n        },\n        removeLocalFilter: ({ index }) => {\n            actions.setFilters(values.localFilters.filter((_, i) => i !== index))\n        },\n        addFilter: () => {\n            actions.setFilters([\n                ...values.localFilters,\n                { id: null, type: EntityTypes.NEW_ENTITY, order: values.localFilters.length },\n            ])\n        },\n        setFilters: ({ filters }) => {\n            props.setFilters(toFilters(filters))\n        },\n    }),\n})\n","import React, { Component } from 'react'\nimport { Card } from '../../lib/utils'\n\nexport class ActionSelectInfo extends Component {\n    infoDiv = React.createRef()\n    componentDidMount(prevProps) {\n        if (!this.infoDiv.current) return\n        let rect = this.props.boundingRect\n        this.infoDiv.current.style.top = rect.top - rect.height / 2 + 'px'\n        this.infoDiv.current.style.left = rect.left + rect.width + 'px'\n        this.infoDiv.current.style.opacity = 1\n    }\n    componentDidUpdate() {\n        this.componentDidMount()\n    }\n    render() {\n        let { entity, isOpen } = this.props\n        if (!entity) return null\n        return (\n            <div className=\"select-box-info\" ref={this.infoDiv} style={{ opacity: isOpen ? 1 : 0 }}>\n                <div style={{ marginBottom: '0.5rem' }}>{entity.name}</div>\n                {entity.steps &&\n                    entity.steps.map((step, index) => (\n                        <div key={step.id}>\n                            <Card key={step.id} style={{ marginBottom: 0 }}>\n                                <div className=\"card-body\">\n                                    <strong>\n                                        {step.event && step.event[0] == '$'\n                                            ? step.event[1].toUpperCase() + step.event.slice(2)\n                                            : step.event}\n                                    </strong>\n                                    <ul style={{ listStyle: 'none' }}>\n                                        {step.selector && (\n                                            <li>\n                                                CSS selector matches\n                                                <pre>{step.selector}</pre>\n                                            </li>\n                                        )}\n                                        {step.tag_name && (\n                                            <li>\n                                                Tag name matches <pre>{step.tag_name}</pre>\n                                            </li>\n                                        )}\n                                        {step.text && (\n                                            <li>\n                                                Text matches <pre>{step.text}</pre>\n                                            </li>\n                                        )}\n                                        {step.href && (\n                                            <li>\n                                                Link HREF matches <pre>{step.href}</pre>\n                                            </li>\n                                        )}\n                                        {step.url && (\n                                            <li>\n                                                URL {step.url_matching == 'contains' ? 'contains' : 'matches'}{' '}\n                                                <pre>{step.url}</pre>\n                                            </li>\n                                        )}\n                                    </ul>\n                                </div>\n                            </Card>\n                            {index < entity.steps.length - 1 && (\n                                <div className=\"secondary\" style={{ textAlign: 'center', margin: '1rem' }}>\n                                    OR\n                                </div>\n                            )}\n                        </div>\n                    ))}\n            </div>\n        )\n    }\n}\n","import React, { Component } from 'react'\nimport { capitalizeFirstLetter } from '~/lib/utils'\n\nexport default class ActionSelectTab extends Component {\n    render() {\n        let { entityType, chooseEntityType, allTypes } = this.props\n        return (\n            <div style={{ display: 'flex', flexDirection: 'row', height: '25px', borderBottom: '1px solid #cccccc' }}>\n                {allTypes.map((type, index) => (\n                    <div\n                        key={index}\n                        style={{\n                            backgroundColor: entityType == type ? '#eeeeee' : 'white',\n                            flex: 1,\n                            display: 'flex',\n                            justifyContent: 'center',\n                            borderTopLeftRadius: index == 0 ? '5px' : '0px',\n                            borderTopRightRadius: index == allTypes.length - 1 ? '5px' : '0px',\n                            cursor: 'pointer',\n                        }}\n                        onClick={() => chooseEntityType(type)}\n                    >\n                        {capitalizeFirstLetter(type)}\n                    </div>\n                ))}\n            </div>\n        )\n    }\n}\n","import React, { Component, useState } from 'react'\nimport Select, { components } from 'react-select'\nimport { ActionSelectInfo } from 'scenes/trends/ActionSelectInfo'\nimport { selectStyle } from '../utils'\nimport PropTypes from 'prop-types'\nimport ActionSelectTab from './ActionSelectTab'\nimport { Link } from 'lib/components/Link'\n\nconst determineActiveTab = props => {\n    if (props.selected) {\n        return props.selected\n    } else {\n        return Array.isArray(props.children) ? props.children[0].props.title : props.children.props.title\n    }\n}\n\nexport function ActionSelectTabs(props) {\n    let [activeTab, setActiveTab] = useState(determineActiveTab(props))\n    let [labels] = useState(\n        Array.isArray(props.children) ? props.children.map(child => child.props.title) : [props.children.props.title]\n    )\n    return (\n        <div className=\"select-box\" style={{ padding: 0 }}>\n            {labels.length > 1 && (\n                <ActionSelectTab\n                    entityType={activeTab}\n                    allTypes={labels}\n                    chooseEntityType={setActiveTab}\n                ></ActionSelectTab>\n            )}\n            {Array.isArray(props.children)\n                ? props.children.map(child => {\n                      if (child.props.title !== activeTab) return undefined\n                      return child\n                  })\n                : props.children}\n        </div>\n    )\n}\n\nexport class ActionSelectPanel extends Component {\n    state = {\n        infoOpen: false,\n    }\n\n    Option = props => {\n        return (\n            <div\n                onMouseOver={e =>\n                    this.setState({\n                        infoOpen: true,\n                        infoBoundingRect: e.target.getBoundingClientRect(),\n                        infoActionId: props.value,\n                    })\n                }\n                onMouseOut={e => {\n                    this.setState({ infoOpen: false })\n                }}\n            >\n                <components.Option {...props} />\n            </div>\n        )\n    }\n\n    render() {\n        return (\n            <div style={{ padding: '1rem', height: '90%', width: '100%' }}>\n                {this.props.redirect}\n                {this.state.infoOpen && (\n                    <ActionSelectInfo\n                        isOpen={this.state.infoOpen}\n                        boundingRect={this.state.infoBoundingRect}\n                        entity={this.props.onHover(this.state.infoActionId)}\n                    />\n                )}\n                <Select\n                    onBlur={e => {\n                        if (e.relatedTarget && e.relatedTarget.tagName == 'A') return\n                        this.setState({ infoOpen: false })\n                    }}\n                    onChange={this.props.onSelect}\n                    defaultMenuIsOpen={this.props.defaultMenuIsOpen}\n                    autoFocus={true}\n                    value={this.props.active}\n                    className=\"select-box-select\"\n                    styles={selectStyle}\n                    components={{ Option: this.Option }}\n                    options={this.props.options}\n                />\n                {this.props.message}\n            </div>\n        )\n    }\n}\n\nActionSelectPanel.propTypes = {\n    options: PropTypes.array.isRequired,\n    defaultMenuIsOpen: PropTypes.bool.isRequired,\n    onSelect: PropTypes.func.isRequired,\n    title: PropTypes.string.isRequired,\n    onHover: PropTypes.func.isRequired,\n}\n","import React, { useRef, useEffect } from 'react'\nimport { useActions, useValues } from 'kea'\nimport { EntityTypes } from '../trendsLogic'\nimport { ActionSelectPanel, ActionSelectTabs } from '~/lib/components/ActionSelectBox'\nimport { Link } from 'lib/components/Link'\nimport { userLogic } from 'scenes/userLogic'\nimport { actionsModel } from '~/models/actionsModel'\n\nexport function ActionFilterDropdown({ onClickOutside, logic }) {\n    const dropdownRef = useRef()\n    const { selectedFilter } = useValues(logic)\n    const { eventNamesGrouped } = useValues(userLogic)\n    const { actionsGrouped } = useValues(actionsModel)\n\n    const deselect = e => {\n        if (dropdownRef.current.contains(e.target)) {\n            return\n        }\n        onClickOutside && onClickOutside(e)\n    }\n\n    useEffect(() => {\n        document.addEventListener('mousedown', deselect)\n        return () => {\n            document.removeEventListener('mousedown', deselect)\n        }\n    }, [])\n\n    return (\n        <div ref={dropdownRef} className=\"action-filter-dropdown\">\n            <ActionSelectTabs\n                selected={\n                    selectedFilter.type && selectedFilter.type !== EntityTypes.NEW_ENTITY ? selectedFilter.type : null\n                }\n            >\n                <ActionPanelContainer\n                    title=\"actions\"\n                    entityType={EntityTypes.ACTIONS}\n                    options={actionsGrouped}\n                    panelIndex={0}\n                    logic={logic}\n                />\n                <ActionPanelContainer\n                    title=\"events\"\n                    entityType={EntityTypes.EVENTS}\n                    options={eventNamesGrouped}\n                    panelIndex={1}\n                    logic={logic}\n                />\n            </ActionSelectTabs>\n        </div>\n    )\n}\n\nexport function ActionPanelContainer({ entityType, panelIndex, options, logic }) {\n    const { entities, selectedFilter, filters } = useValues(logic)\n    const { updateFilter } = useActions(logic)\n\n    const dropDownOnSelect = item => updateFilter({ type: entityType, value: item.value, index: selectedFilter.index })\n    const dropDownOnHover = value => entities[entityType].filter(a => a.id === value)[0]\n\n    const redirect = () => {\n        if (selectedFilter && selectedFilter.type === EntityTypes.ACTIONS && entityType === EntityTypes.ACTIONS) {\n            const action = entities[selectedFilter.type].filter(a => a.id === selectedFilter.filter.id)[0]\n            return (\n                <a href={'/action/' + selectedFilter.filter.id} target=\"_blank\">\n                    Edit \"{action.name}\" <i className=\"fi flaticon-export\" />\n                </a>\n            )\n        } else {\n            return null\n        }\n    }\n\n    const message = () => {\n        if (entityType === EntityTypes.ACTIONS && !filters[EntityTypes.ACTIONS]) {\n            return (\n                <div\n                    style={{\n                        height: '100%',\n                        display: 'flex',\n                        flexDirection: 'column',\n                        justifyContent: 'center',\n                        alignItems: 'center',\n                    }}\n                >\n                    <p>You don't have any actions defined yet. </p>\n                    <Link to=\"/action\">Click here to define an action.</Link>\n                </div>\n            )\n        } else {\n            return null\n        }\n    }\n\n    return (\n        <ActionSelectPanel\n            key={panelIndex}\n            title={entityType}\n            options={options}\n            defaultMenuIsOpen={true}\n            onSelect={dropDownOnSelect}\n            onHover={dropDownOnHover}\n            active={null}\n            redirect={redirect()}\n            message={message()}\n        />\n    )\n}\n","import React, { useRef, useState } from 'react'\nimport { useActions, useValues } from 'kea'\nimport { EntityTypes } from '../trendsLogic'\nimport { CloseButton } from '~/lib/utils'\nimport { Dropdown } from '~/lib/components/Dropdown'\nimport { ActionFilterDropdown } from './ActionFilterDropdown'\nimport { Tooltip } from 'antd'\nimport { PropertyFilters } from 'lib/components/PropertyFilters/PropertyFilters'\nimport { userLogic } from 'scenes/userLogic'\n\nconst determineFilterLabel = (visible, filter) => {\n    if (visible) return 'Hide Filters'\n\n    if (filter.properties && Object.keys(filter.properties).length > 0) {\n        return (\n            Object.keys(filter.properties).length + ' Filter' + (Object.keys(filter.properties).length === 1 ? '' : 's')\n        )\n    }\n    return 'Add Filters'\n}\n\nexport function ActionFilterRow({ logic, filter, index }) {\n    const node = useRef()\n    const { selectedFilter, entities } = useValues(logic)\n    const { selectFilter, updateFilterMath, removeLocalFilter, updateFilterProperty } = useActions(logic)\n    const { eventProperties } = useValues(userLogic)\n    const [entityFilterVisible, setEntityFilterVisible] = useState(false)\n\n    let entity, name, value\n    let math = filter.math\n    const onClose = () => {\n        removeLocalFilter({ value: filter.id, type: filter.type, index })\n    }\n    const onMathSelect = (_, math) => {\n        updateFilterMath({ math, value: filter.id, type: filter.type, index: index })\n    }\n\n    const dropDownCondition = () =>\n        selectedFilter && selectedFilter.type === filter.type && selectedFilter.index === index\n\n    const onClick = () => {\n        if (selectedFilter && selectedFilter.type === filter.type && selectedFilter.index === index) selectFilter(null)\n        else selectFilter({ filter, type: filter.type, index })\n    }\n\n    if (filter.type === EntityTypes.NEW_ENTITY) {\n        name = null\n        value = null\n    } else {\n        entity = entities[filter.type].filter(action => action.id === filter.id)[0] || {}\n        name = entity.name || filter.name\n        value = entity.id || filter.id\n    }\n    return (\n        <div>\n            <button\n                ref={node}\n                className=\"filter-action\"\n                type=\"button\"\n                onClick={onClick}\n                style={{\n                    border: 0,\n                    padding: 0,\n                    fontWeight: 500,\n                    borderBottom: '1.5px dotted var(--blue)',\n                }}\n            >\n                {name || 'Select action'}\n            </button>\n            <MathSelector math={math} index={index} onMathSelect={onMathSelect} />\n            <div className=\"btn btn-sm btn-light\" onClick={() => setEntityFilterVisible(!entityFilterVisible)}>\n                {determineFilterLabel(entityFilterVisible, filter)}\n            </div>\n            <CloseButton\n                onClick={onClose}\n                style={{\n                    float: 'none',\n                    marginLeft: 8,\n                    position: 'absolute',\n                    marginTop: 3,\n                }}\n            />\n            {entityFilterVisible && (\n                <div className=\"ml-4\">\n                    <PropertyFilters\n                        pageKey={`${index}-${value}-filter`}\n                        properties={eventProperties}\n                        propertyFilters={filter.properties}\n                        onChange={properties => updateFilterProperty({ properties, index })}\n                        style={{ marginBottom: 0 }}\n                    />\n                </div>\n            )}\n            {dropDownCondition() && (\n                <ActionFilterDropdown\n                    logic={logic}\n                    onClickOutside={e => {\n                        if (node.current.contains(e.target)) {\n                            return\n                        }\n                        selectFilter(null)\n                    }}\n                />\n            )}\n        </div>\n    )\n}\n\nfunction MathSelector(props) {\n    let items = ['Total', 'DAU']\n    return (\n        <Dropdown\n            title={items[items.map(i => i.toLowerCase()).indexOf(props.math)] || 'Total'}\n            buttonClassName=\"btn btn-sm btn-light\"\n            style={{ marginLeft: 32, marginRight: 16 }}\n        >\n            <Tooltip\n                placement=\"right\"\n                title=\"Total shows total event volume. If a user performs an event 3 times on one day it counts as 3.\"\n            >\n                <a href=\"#\" className=\"dropdown-item\" onClick={() => props.onMathSelect(props.index, 'total')}>\n                    Total\n                </a>\n            </Tooltip>\n\n            <Tooltip\n                placement=\"right\"\n                title=\"Daily Active Users. Selecting DAU will mean a user performing an event 3 times on one day counts as 1.\"\n            >\n                <a href=\"#\" className=\"dropdown-item\" onClick={() => props.onMathSelect(props.index, 'dau')}>\n                    DAU\n                </a>\n            </Tooltip>\n        </Dropdown>\n    )\n}\n","import React, { useEffect } from 'react'\nimport { useActions, useValues } from 'kea'\nimport { entityFilterLogic } from './entityFilterLogic'\nimport { ActionFilterRow } from './ActionFilterRow'\nimport { Button } from 'antd'\n\nexport function ActionFilter({ setFilters, filters, typeKey }) {\n    const logic = entityFilterLogic({ setFilters, filters, typeKey })\n\n    const { localFilters } = useValues(logic)\n    const { addFilter, setLocalFilters } = useActions(logic)\n\n    // No way around this. Somehow the ordering of the logic calling each other causes stale \"localFilters\"\n    // to be shown on the /funnels page, even if we try to use a selector with props to hydrate it\n    useEffect(() => {\n        setLocalFilters(filters)\n    }, [filters])\n\n    return (\n        <div>\n            {localFilters &&\n                localFilters.map((filter, index) => (\n                    <ActionFilterRow logic={logic} filter={filter} index={index} key={index} />\n                ))}\n            <Button type=\"primary\" onClick={() => addFilter()} style={{ marginTop: '0.5rem' }}>\n                Add action/event\n            </Button>\n        </div>\n    )\n}\n","import React, { Component } from 'react'\nimport api from 'lib/api'\nimport FunnelGraph from 'funnel-graph-js'\nimport { Link } from 'lib/components/Link'\nimport { Loading } from 'lib/utils'\nimport PropTypes from 'prop-types'\n\nexport class FunnelViz extends Component {\n    container = React.createRef()\n    graphContainer = React.createRef()\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            funnel: props.funnel,\n        }\n        this.buildChart = this.buildChart.bind(this)\n        if (!props.funnel) this.fetchFunnel.call(this)\n    }\n    componentDidMount() {\n        if (this.props.funnel) this.buildChart()\n        window.addEventListener('resize', this.buildChart)\n    }\n    componentWillUnmount() {\n        window.removeEventListener('resize', this.buildChart)\n    }\n    fetchFunnel() {\n        api.get('api/funnel/' + this.props.filters.funnel_id).then(funnel => this.setState({ funnel }, this.buildChart))\n    }\n    componentDidUpdate(prevProps) {\n        if (prevProps.funnel !== this.props.funnel && this.state.funnel) {\n            this.setState({ funnel: this.props.funnel }, this.buildChart)\n        }\n    }\n    buildChart() {\n        if (!this.state.funnel || this.state.funnel.steps.length == 0) return\n        if (this.container.current) this.container.current.innerHTML = ''\n        let graph = new FunnelGraph({\n            container: '.funnel-graph',\n            data: {\n                labels: this.state.funnel.steps.map(step => `${step.name} (${step.count})`),\n                values: this.state.funnel.steps.map(step => step.count),\n                colors: ['#66b0ff', 'var(--blue)'],\n            },\n            displayPercent: true,\n        })\n        graph.createContainer = () => {}\n        graph.container = this.container.current\n        graph.graphContainer = document.createElement('div')\n        graph.graphContainer.classList.add('svg-funnel-js__container')\n        graph.container.appendChild(graph.graphContainer)\n\n        graph.draw()\n    }\n    render() {\n        let { funnel } = this.state\n        return funnel ? (\n            funnel.steps.length > 0 ? (\n                <div ref={this.container} className=\"svg-funnel-js\" style={{ height: '100%', width: '100%' }}></div>\n            ) : (\n                <p style={{ margin: '1rem' }}>\n                    This funnel doesn't have any steps.{' '}\n                    <Link to={'/funnel/' + funnel.id}>Click here to add some steps.</Link>\n                </p>\n            )\n        ) : (\n            <Loading />\n        )\n    }\n}\nFunnelViz.propTypes = {\n    funnel: PropTypes.object,\n    filters: PropTypes.shape({ funnel_id: PropTypes.number }),\n}\n","module.exports = require('./src/js/main').default;\n","import React, { Component } from 'react'\nimport api from '../api'\nimport { Modal } from './Modal'\nimport { toast } from 'react-toastify'\nimport { Link } from 'lib/components/Link'\nimport { Button } from 'antd'\n\nfunction momentToString(date) {\n    if (date && date._isAMomentObject) return date.format('YYYY-MM-DD')\n    return date\n}\n\nexport class SaveToDashboard extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {}\n        this.Modal = this.Modal.bind(this)\n        this.save = this.save.bind(this)\n    }\n    Toast({ closeToast }) {\n        return (\n            <div>\n                Panel added to dashboard.&nbsp;\n                <Link to=\"/dashboard\">Click here to see it.</Link>\n            </div>\n        )\n    }\n    save(event) {\n        let { filters } = this.props\n        event.preventDefault()\n        api.create('api/dashboard', {\n            filters: {\n                ...filters,\n                date_from: momentToString(filters.date_from),\n                date_to: momentToString(filters.date_to),\n            },\n            type: this.props.type,\n            name: event.target.name.value,\n        }).then(() => {\n            toast(this.Toast)\n            this.setState({ openModal: false })\n        })\n    }\n    Modal() {\n        return (\n            <Modal title=\"Add graph to dashboard\" onDismiss={() => this.setState({ openModal: false })}>\n                <form onSubmit={this.save}>\n                    <label>Panel name on dashboard</label>\n                    <input\n                        name=\"name\"\n                        autoFocus\n                        required\n                        type=\"text\"\n                        className=\"form-control\"\n                        placeholder=\"Users who did x\"\n                        defaultValue={this.props.name}\n                    />\n                    <br />\n                    <button type=\"submit\" className=\"btn btn-success\">\n                        Add panel to dashboard\n                    </button>\n                </form>\n            </Modal>\n        )\n    }\n    render() {\n        return (\n            <span className=\"save-to-dashboard\">\n                {this.state.openModal && <this.Modal />}\n                <Button onClick={() => this.setState({ openModal: true })} type=\"primary\">\n                    Add to dashboard\n                </Button>\n            </span>\n        )\n    }\n}\n","const roundPoint = number => Math.round(number * 10) / 10;\nconst formatNumber = number => Number(number).toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, '$1,');\n\nexport { roundPoint, formatNumber };\n","import { roundPoint } from './number';\n\nconst createCurves = (x1, y1, x2, y2) => ` C${roundPoint((x2 + x1) / 2)},${y1} `\n    + `${roundPoint((x2 + x1) / 2)},${y2} ${x2},${y2}`;\n\nconst createVerticalCurves = (x1, y1, x2, y2) => ` C${x1},${roundPoint((y2 + y1) / 2)} `\n    + `${x2},${roundPoint((y2 + y1) / 2)} ${x2},${y2}`;\n\n/*\n    A funnel segment is draw in a clockwise direction.\n    Path 1-2 is drawn,\n    then connected with a straight vertical line 2-3,\n    then a line 3-4 is draw (using YNext points going in backwards direction)\n    then path is closed (connected with the starting point 1).\n\n    1---------->2\n    ^           |\n    |           v\n    4<----------3\n\n    On the graph on line 20 it works like this:\n    A#0, A#1, A#2, A#3, B#3, B#2, B#1, B#0, close the path.\n\n    Points for path \"B\" are passed as the YNext param.\n */\n\nconst createPath = (index, X, Y, YNext) => {\n    let str = `M${X[0]},${Y[0]}`;\n\n    for (let i = 0; i < X.length - 1; i++) {\n        str += createCurves(X[i], Y[i], X[i + 1], Y[i + 1]);\n    }\n\n    str += ` L${[...X].pop()},${[...YNext].pop()}`;\n\n    for (let i = X.length - 1; i > 0; i--) {\n        str += createCurves(X[i], YNext[i], X[i - 1], YNext[i - 1]);\n    }\n\n    str += ' Z';\n\n    return str;\n};\n\n/*\n    In a vertical path we go counter-clockwise\n\n    1<----------4\n    |           ^\n    v           |\n    2---------->3\n */\n\nconst createVerticalPath = (index, X, XNext, Y) => {\n    let str = `M${X[0]},${Y[0]}`;\n\n    for (let i = 0; i < X.length - 1; i++) {\n        str += createVerticalCurves(X[i], Y[i], X[i + 1], Y[i + 1]);\n    }\n\n    str += ` L${[...XNext].pop()},${[...Y].pop()}`;\n\n    for (let i = X.length - 1; i > 0; i--) {\n        str += createVerticalCurves(XNext[i], Y[i], XNext[i - 1], Y[i - 1]);\n    }\n\n    str += ' Z';\n\n    return str;\n};\n\nexport {\n    createCurves, createVerticalCurves, createPath, createVerticalPath\n};\n","const setAttrs = (element, attributes) => {\n    if (typeof attributes === 'object') {\n        Object.keys(attributes).forEach((key) => {\n            element.setAttribute(key, attributes[key]);\n        });\n    }\n};\n\nconst removeAttrs = (element, ...attributes) => {\n    attributes.forEach((attribute) => {\n        element.removeAttribute(attribute);\n    });\n};\n\nconst createSVGElement = (element, container, attributes) => {\n    const el = document.createElementNS('http://www.w3.org/2000/svg', element);\n\n    if (typeof attributes === 'object') {\n        setAttrs(el, attributes);\n    }\n\n    if (typeof container !== 'undefined') {\n        container.appendChild(el);\n    }\n\n    return el;\n};\n\nconst generateLegendBackground = (color, direction = 'horizontal') => {\n    if (typeof color === 'string') {\n        return `background-color: ${color}`;\n    }\n\n    if (color.length === 1) {\n        return `background-color: ${color[0]}`;\n    }\n\n    return `background-image: linear-gradient(${direction === 'horizontal'\n        ? 'to right, '\n        : ''}${color.join(', ')})`;\n};\n\nconst defaultColors = ['#FF4589', '#FF5050',\n    '#05DF9D', '#4FF2FD',\n    '#2D9CDB', '#A0BBFF',\n    '#FFD76F', '#F2C94C',\n    '#FF9A9A', '#FFB178'];\n\nconst getDefaultColors = (number) => {\n    const colors = [...defaultColors];\n    const colorSet = [];\n\n    for (let i = 0; i < number; i++) {\n        // get a random color\n        const index = Math.abs(Math.round(Math.random() * (colors.length - 1)));\n        // push it to the list\n        colorSet.push(colors[index]);\n        // and remove it, so that it is not chosen again\n        colors.splice(index, 1);\n    }\n    return colorSet;\n};\n\n/*\n    Used in comparing existing values to value provided on update\n    It is limited to comparing arrays on purpose\n    Name is slightly unusual, in order not to be confused with Lodash method\n */\nconst areEqual = (value, newValue) => {\n    // If values are not of the same type\n    const type = Object.prototype.toString.call(value);\n    if (type !== Object.prototype.toString.call(newValue)) return false;\n    if (type !== '[object Array]') return false;\n\n    if (value.length !== newValue.length) return false;\n\n    for (let i = 0; i < value.length; i++) {\n        // if the it's a two dimensional array\n        const currentType = Object.prototype.toString.call(value[i]);\n        if (currentType !== Object.prototype.toString.call(newValue[i])) return false;\n        if (currentType === '[object Array]') {\n            // if row lengths are not equal then arrays are not equal\n            if (value[i].length !== newValue[i].length) return false;\n            // compare each element in the row\n            for (let j = 0; j < value[i].length; j++) {\n                if (value[i][j] !== newValue[i][j]) {\n                    return false;\n                }\n            }\n        } else if (value[i] !== newValue[i]) {\n            // if it's a one dimensional array element\n            return false;\n        }\n    }\n\n    return true;\n};\n\nexport {\n    generateLegendBackground, getDefaultColors, areEqual, createSVGElement, setAttrs, removeAttrs, defaultColors\n};\n","const generateRandomIdString = prefix => Math.random().toString(36).replace('0.', prefix || '');\n\nexport default generateRandomIdString;\n","/* eslint-disable no-trailing-spaces */\n/* global HTMLElement */\nimport { roundPoint, formatNumber } from './number';\nimport { createPath, createVerticalPath } from './path';\nimport {\n    generateLegendBackground, getDefaultColors, createSVGElement, setAttrs, removeAttrs\n} from './graph';\nimport generateRandomIdString from './random';\n\nclass FunnelGraph {\n    constructor(options) {\n        this.containerSelector = options.container;\n        this.gradientDirection = (options.gradientDirection && options.gradientDirection === 'vertical')\n            ? 'vertical'\n            : 'horizontal';\n        this.direction = (options.direction && options.direction === 'vertical') ? 'vertical' : 'horizontal';\n        this.labels = FunnelGraph.getLabels(options);\n        this.subLabels = FunnelGraph.getSubLabels(options);\n        this.values = FunnelGraph.getValues(options);\n        this.percentages = this.createPercentages();\n        this.colors = options.data.colors || getDefaultColors(this.is2d() ? this.getSubDataSize() : 2);\n        this.displayPercent = options.displayPercent || false;\n        this.data = options.data;\n        this.height = options.height;\n        this.width = options.width;\n        this.subLabelValue = options.subLabelValue || 'percent';\n    }\n\n    /**\n    An example of a two-dimensional funnel graph\n    #0..................\n                       ...#1................\n                                           ......\n    #0********************#1**                    #2.........................#3 (A)\n                              *******************\n                                                  #2*************************#3 (B)\n                                                  #2+++++++++++++++++++++++++#3 (C)\n                              +++++++++++++++++++\n    #0++++++++++++++++++++#1++                    #2-------------------------#3 (D)\n                                           ------\n                       ---#1----------------\n    #0-----------------\n     Main axis is the primary axis of the graph.\n     In a horizontal graph it's the X axis, and Y is the cross axis.\n     However we use the names \"main\" and \"cross\" axis,\n     because in a vertical graph the primary axis is the Y axis\n     and the cross axis is the X axis.\n     First step of drawing the funnel graph is getting the coordinates of points,\n     that are used when drawing the paths.\n     There are 4 paths in the example above: A, B, C and D.\n     Such funnel has 3 labels and 3 subLabels.\n     This means that the main axis has 4 points (number of labels + 1)\n     One the ASCII illustrated graph above, those points are illustrated with a # symbol.\n    */\n    getMainAxisPoints() {\n        const size = this.getDataSize();\n        const points = [];\n        const fullDimension = this.isVertical() ? this.getHeight() : this.getWidth();\n        for (let i = 0; i <= size; i++) {\n            points.push(roundPoint(fullDimension * i / size));\n        }\n        return points;\n    }\n\n    getCrossAxisPoints() {\n        const points = [];\n        const fullDimension = this.getFullDimension();\n        // get half of the graph container height or width, since funnel shape is symmetric\n        // we use this when calculating the \"A\" shape\n        const dimension = fullDimension / 2;\n        if (this.is2d()) {\n            const totalValues = this.getValues2d();\n            const max = Math.max(...totalValues);\n\n            // duplicate last value\n            totalValues.push([...totalValues].pop());\n            // get points for path \"A\"\n            points.push(totalValues.map(value => roundPoint((max - value) / max * dimension)));\n            // percentages with duplicated last value\n            const percentagesFull = this.getPercentages2d();\n            const pointsOfFirstPath = points[0];\n\n            for (let i = 1; i < this.getSubDataSize(); i++) {\n                const p = points[i - 1];\n                const newPoints = [];\n\n                for (let j = 0; j < this.getDataSize(); j++) {\n                    newPoints.push(roundPoint(\n                        // eslint-disable-next-line comma-dangle\n                        p[j] + (fullDimension - pointsOfFirstPath[j] * 2) * (percentagesFull[j][i - 1] / 100)\n                    ));\n                }\n\n                // duplicate the last value as points #2 and #3 have the same value on the cross axis\n                newPoints.push([...newPoints].pop());\n                points.push(newPoints);\n            }\n\n            // add points for path \"D\", that is simply the \"inverted\" path \"A\"\n            points.push(pointsOfFirstPath.map(point => fullDimension - point));\n        } else {\n            // As you can see on the visualization above points #2 and #3 have the same cross axis coordinate\n            // so we duplicate the last value\n            const max = Math.max(...this.values);\n            const values = [...this.values].concat([...this.values].pop());\n            // if the graph is simple (not two-dimensional) then we have only paths \"A\" and \"D\"\n            // which are symmetric. So we get the points for \"A\" and then get points for \"D\" by subtracting \"A\"\n            // points from graph cross dimension length\n            points.push(values.map(value => roundPoint((max - value) / max * dimension)));\n            points.push(points[0].map(point => fullDimension - point));\n        }\n\n        return points;\n    }\n\n    getGraphType() {\n        return this.values && this.values[0] instanceof Array ? '2d' : 'normal';\n    }\n\n    is2d() {\n        return this.getGraphType() === '2d';\n    }\n\n    isVertical() {\n        return this.direction === 'vertical';\n    }\n\n    getDataSize() {\n        return this.values.length;\n    }\n\n    getSubDataSize() {\n        return this.values[0].length;\n    }\n\n    getFullDimension() {\n        return this.isVertical() ? this.getWidth() : this.getHeight();\n    }\n\n    static getSubLabels(options) {\n        if (!options.data) {\n            throw new Error('Data is missing');\n        }\n\n        const { data } = options;\n\n        if (typeof data.subLabels === 'undefined') return [];\n\n        return data.subLabels;\n    }\n\n    static getLabels(options) {\n        if (!options.data) {\n            throw new Error('Data is missing');\n        }\n\n        const { data } = options;\n\n        if (typeof data.labels === 'undefined') return [];\n\n        return data.labels;\n    }\n\n    addLabels() {\n        const holder = document.createElement('div');\n        holder.setAttribute('class', 'svg-funnel-js__labels');\n\n        this.percentages.forEach((percentage, index) => {\n            const labelElement = document.createElement('div');\n            labelElement.setAttribute('class', `svg-funnel-js__label label-${index + 1}`);\n\n            const title = document.createElement('div');\n            title.setAttribute('class', 'label__title');\n            title.textContent = this.labels[index] || '';\n\n            const value = document.createElement('div');\n            value.setAttribute('class', 'label__value');\n\n            const valueNumber = this.is2d() ? this.getValues2d()[index] : this.values[index];\n            value.textContent = formatNumber(valueNumber);\n\n            const percentageValue = document.createElement('div');\n            percentageValue.setAttribute('class', 'label__percentage');\n            percentageValue.textContent = `${percentage.toString()}%`;\n\n            labelElement.appendChild(value);\n            labelElement.appendChild(title);\n            if (this.displayPercent) {\n                labelElement.appendChild(percentageValue);\n            }\n\n            if (this.is2d()) {\n                const segmentPercentages = document.createElement('div');\n                segmentPercentages.setAttribute('class', 'label__segment-percentages');\n                let percentageList = '<ul class=\"segment-percentage__list\">';\n\n                const twoDimPercentages = this.getPercentages2d();\n\n                this.subLabels.forEach((subLabel, j) => {\n                    const subLabelDisplayValue = this.subLabelValue === 'percent'\n                        ? `${twoDimPercentages[index][j]}%`\n                        : formatNumber(this.values[index][j]);\n                    percentageList += `<li>${this.subLabels[j]}:\n    <span class=\"percentage__list-label\">${subLabelDisplayValue}</span>\n </li>`;\n                });\n                percentageList += '</ul>';\n                segmentPercentages.innerHTML = percentageList;\n                labelElement.appendChild(segmentPercentages);\n            }\n\n            holder.appendChild(labelElement);\n        });\n\n        this.container.appendChild(holder);\n    }\n\n    addSubLabels() {\n        if (this.subLabels) {\n            const subLabelsHolder = document.createElement('div');\n            subLabelsHolder.setAttribute('class', 'svg-funnel-js__subLabels');\n\n            let subLabelsHTML = '';\n\n            this.subLabels.forEach((subLabel, index) => {\n                subLabelsHTML += `<div class=\"svg-funnel-js__subLabel svg-funnel-js__subLabel-${index + 1}\">\n    <div class=\"svg-funnel-js__subLabel--color\"\n        style=\"${generateLegendBackground(this.colors[index], this.gradientDirection)}\"></div>\n    <div class=\"svg-funnel-js__subLabel--title\">${subLabel}</div>\n</div>`;\n            });\n\n            subLabelsHolder.innerHTML = subLabelsHTML;\n            this.container.appendChild(subLabelsHolder);\n        }\n    }\n\n    createContainer() {\n        if (!this.containerSelector) {\n            throw new Error('Container is missing');\n        }\n\n        if (typeof this.containerSelector === 'string') {\n            this.container = document.querySelector(this.containerSelector);\n            if (!this.container) {\n                throw new Error(`Container cannot be found (selector: ${this.containerSelector}).`);\n            }\n        } else if (this.container instanceof HTMLElement) {\n            this.container = this.containerSelector;\n        } else {\n            throw new Error('Container must either be a selector string or an HTMLElement.');\n        }\n\n        this.container.classList.add('svg-funnel-js');\n\n        this.graphContainer = document.createElement('div');\n        this.graphContainer.classList.add('svg-funnel-js__container');\n        this.container.appendChild(this.graphContainer);\n\n        if (this.direction === 'vertical') {\n            this.container.classList.add('svg-funnel-js--vertical');\n        }\n    }\n\n    setValues(v) {\n        this.values = v;\n        return this;\n    }\n\n    setDirection(d) {\n        this.direction = d;\n        return this;\n    }\n\n    setHeight(h) {\n        this.height = h;\n        return this;\n    }\n\n    setWidth(w) {\n        this.width = w;\n        return this;\n    }\n\n    static getValues(options) {\n        if (!options.data) {\n            return [];\n        }\n\n        const { data } = options;\n\n        if (typeof data === 'object') {\n            return data.values;\n        }\n\n        return [];\n    }\n\n    getValues2d() {\n        const values = [];\n\n        this.values.forEach((valueSet) => {\n            values.push(valueSet.reduce((sum, value) => sum + value, 0));\n        });\n\n        return values;\n    }\n\n    getPercentages2d() {\n        const percentages = [];\n\n        this.values.forEach((valueSet) => {\n            const total = valueSet.reduce((sum, value) => sum + value, 0);\n            percentages.push(valueSet.map(value => (total === 0 ? 0 : roundPoint(value * 100 / total))));\n        });\n\n        return percentages;\n    }\n\n    createPercentages() {\n        let values = [];\n\n        if (this.is2d()) {\n            values = this.getValues2d();\n        } else {\n            values = [...this.values];\n        }\n\n        const max = Math.max(...values);\n        return values.map(value => (value === 0 ? 0 : roundPoint(value * 100 / max)));\n    }\n\n    applyGradient(svg, path, colors, index) {\n        const defs = (svg.querySelector('defs') === null)\n            ? createSVGElement('defs', svg)\n            : svg.querySelector('defs');\n\n        const gradientName = generateRandomIdString(`funnelGradient-${index}-`);\n\n        const gradient = createSVGElement('linearGradient', defs, {\n            id: gradientName\n        });\n\n        if (this.gradientDirection === 'vertical') {\n            setAttrs(gradient, {\n                x1: '0',\n                x2: '0',\n                y1: '0',\n                y2: '1'\n            });\n        }\n\n        const numberOfColors = colors.length;\n\n        for (let i = 0; i < numberOfColors; i++) {\n            createSVGElement('stop', gradient, {\n                'stop-color': colors[i],\n                offset: `${Math.round(100 * i / (numberOfColors - 1))}%`\n            });\n        }\n\n        setAttrs(path, {\n            fill: `url(\"#${gradientName}\")`,\n            stroke: `url(\"#${gradientName}\")`\n        });\n    }\n\n    makeSVG() {\n        const svg = createSVGElement('svg', this.graphContainer, {\n            width: this.getWidth(),\n            height: this.getHeight()\n        });\n\n        const valuesNum = this.getCrossAxisPoints().length - 1;\n        for (let i = 0; i < valuesNum; i++) {\n            const path = createSVGElement('path', svg);\n\n            const color = (this.is2d()) ? this.colors[i] : this.colors;\n            const fillMode = (typeof color === 'string' || color.length === 1) ? 'solid' : 'gradient';\n\n            if (fillMode === 'solid') {\n                setAttrs(path, {\n                    fill: color,\n                    stroke: color\n                });\n            } else if (fillMode === 'gradient') {\n                this.applyGradient(svg, path, color, i + 1);\n            }\n\n            svg.appendChild(path);\n        }\n\n        this.graphContainer.appendChild(svg);\n    }\n\n    getSVG() {\n        const svg = this.container.querySelector('svg');\n\n        if (!svg) {\n            throw new Error('No SVG found inside of the container');\n        }\n\n        return svg;\n    }\n\n    getWidth() {\n        return this.width || this.graphContainer.clientWidth;\n    }\n\n    getHeight() {\n        return this.height || this.graphContainer.clientHeight;\n    }\n\n    getPathDefinitions() {\n        const valuesNum = this.getCrossAxisPoints().length - 1;\n        const paths = [];\n        for (let i = 0; i < valuesNum; i++) {\n            if (this.isVertical()) {\n                const X = this.getCrossAxisPoints()[i];\n                const XNext = this.getCrossAxisPoints()[i + 1];\n                const Y = this.getMainAxisPoints();\n\n                const d = createVerticalPath(i, X, XNext, Y);\n                paths.push(d);\n            } else {\n                const X = this.getMainAxisPoints();\n                const Y = this.getCrossAxisPoints()[i];\n                const YNext = this.getCrossAxisPoints()[i + 1];\n\n                const d = createPath(i, X, Y, YNext);\n                paths.push(d);\n            }\n        }\n\n        return paths;\n    }\n\n    getPathMedian(i) {\n        if (this.isVertical()) {\n            const cross = this.getCrossAxisPoints()[i];\n            const next = this.getCrossAxisPoints()[i + 1];\n            const Y = this.getMainAxisPoints();\n            const X = [];\n            const XNext = [];\n\n            cross.forEach((point, index) => {\n                const m = (point + next[index]) / 2;\n                X.push(m - 1);\n                XNext.push(m + 1);\n            });\n\n            return createVerticalPath(i, X, XNext, Y);\n        }\n\n        const X = this.getMainAxisPoints();\n        const cross = this.getCrossAxisPoints()[i];\n        const next = this.getCrossAxisPoints()[i + 1];\n        const Y = [];\n        const YNext = [];\n\n        cross.forEach((point, index) => {\n            const m = (point + next[index]) / 2;\n            Y.push(m - 1);\n            YNext.push(m + 1);\n        });\n\n        return createPath(i, X, Y, YNext);\n    }\n\n    drawPaths() {\n        const svg = this.getSVG();\n        const paths = svg.querySelectorAll('path');\n        const definitions = this.getPathDefinitions();\n\n        definitions.forEach((definition, index) => {\n            paths[index].setAttribute('d', definition);\n        });\n    }\n\n    draw() {\n        this.createContainer();\n        this.makeSVG();\n\n        this.addLabels();\n\n        if (this.is2d()) {\n            this.addSubLabels();\n        }\n\n        this.drawPaths();\n    }\n\n    /*\n        Methods\n     */\n\n    makeVertical() {\n        if (this.direction === 'vertical') return true;\n\n        this.direction = 'vertical';\n        this.container.classList.add('svg-funnel-js--vertical');\n\n        const svg = this.getSVG();\n        const height = this.getHeight();\n        const width = this.getWidth();\n        setAttrs(svg, { height, width });\n\n        this.drawPaths();\n\n        return true;\n    }\n\n    makeHorizontal() {\n        if (this.direction === 'horizontal') return true;\n\n        this.direction = 'horizontal';\n        this.container.classList.remove('svg-funnel-js--vertical');\n\n        const svg = this.getSVG();\n        const height = this.getHeight();\n        const width = this.getWidth();\n        setAttrs(svg, { height, width });\n\n        this.drawPaths();\n\n        return true;\n    }\n\n    toggleDirection() {\n        if (this.direction === 'horizontal') {\n            this.makeVertical();\n        } else {\n            this.makeHorizontal();\n        }\n    }\n\n    gradientMakeVertical() {\n        if (this.gradientDirection === 'vertical') return true;\n\n        this.gradientDirection = 'vertical';\n        const gradients = this.graphContainer.querySelectorAll('linearGradient');\n\n        for (let i = 0; i < gradients.length; i++) {\n            setAttrs(gradients[i], {\n                x1: '0',\n                x2: '0',\n                y1: '0',\n                y2: '1'\n            });\n        }\n\n        return true;\n    }\n\n    gradientMakeHorizontal() {\n        if (this.gradientDirection === 'horizontal') return true;\n\n        this.gradientDirection = 'horizontal';\n        const gradients = this.graphContainer.querySelectorAll('linearGradient');\n\n        for (let i = 0; i < gradients.length; i++) {\n            removeAttrs(gradients[i], 'x1', 'x2', 'y1', 'y2');\n        }\n\n        return true;\n    }\n\n    gradientToggleDirection() {\n        if (this.gradientDirection === 'horizontal') {\n            this.gradientMakeVertical();\n        } else {\n            this.gradientMakeHorizontal();\n        }\n    }\n\n    updateWidth(w) {\n        this.width = w;\n        const svg = this.getSVG();\n        const width = this.getWidth();\n        setAttrs(svg, { width });\n\n        this.drawPaths();\n\n        return true;\n    }\n\n    updateHeight(h) {\n        this.height = h;\n        const svg = this.getSVG();\n        const height = this.getHeight();\n        setAttrs(svg, { height });\n\n        this.drawPaths();\n\n        return true;\n    }\n\n    // @TODO: refactor data update\n    updateData(d) {\n        const labels = this.container.querySelector('.svg-funnel-js__labels');\n        const subLabels = this.container.querySelector('.svg-funnel-js__subLabels');\n\n        if (labels) labels.remove();\n        if (subLabels) subLabels.remove();\n\n        this.labels = [];\n        this.colors = getDefaultColors(this.is2d() ? this.getSubDataSize() : 2);\n        this.values = [];\n        this.percentages = [];\n\n        if (typeof d.labels !== 'undefined') {\n            this.labels = FunnelGraph.getLabels({ data: d });\n        }\n        if (typeof d.colors !== 'undefined') {\n            this.colors = d.colors || getDefaultColors(this.is2d() ? this.getSubDataSize() : 2);\n        }\n        if (typeof d.values !== 'undefined') {\n            if (Object.prototype.toString.call(d.values[0]) !== Object.prototype.toString.call(this.values[0])) {\n                this.container.querySelector('svg').remove();\n                this.values = FunnelGraph.getValues({ data: d });\n                this.makeSVG();\n            } else {\n                this.values = FunnelGraph.getValues({ data: d });\n            }\n            this.drawPaths();\n        }\n        this.percentages = this.createPercentages();\n\n        this.addLabels();\n\n        if (typeof d.subLabels !== 'undefined') {\n            this.subLabels = FunnelGraph.getSubLabels({ data: d });\n            this.addSubLabels();\n        }\n    }\n\n    update(o) {\n        if (typeof o.displayPercent !== 'undefined') {\n            if (this.displayPercent !== o.displayPercent) {\n                if (this.displayPercent === true) {\n                    this.container.querySelectorAll('.label__percentage').forEach((label) => {\n                        label.remove();\n                    });\n                } else {\n                    this.container.querySelectorAll('.svg-funnel-js__label').forEach((label, index) => {\n                        const percentage = this.percentages[index];\n                        const percentageValue = document.createElement('div');\n                        percentageValue.setAttribute('class', 'label__percentage');\n\n                        if (percentage !== 100) {\n                            percentageValue.textContent = `${percentage.toString()}%`;\n                            label.appendChild(percentageValue);\n                        }\n                    });\n                }\n            }\n        }\n        if (typeof o.height !== 'undefined') {\n            this.updateHeight(o.height);\n        }\n        if (typeof o.width !== 'undefined') {\n            this.updateWidth(o.width);\n        }\n        if (typeof o.gradientDirection !== 'undefined') {\n            if (o.gradientDirection === 'vertical') {\n                this.gradientMakeVertical();\n            } else if (o.gradientDirection === 'horizontal') {\n                this.gradientMakeHorizontal();\n            }\n        }\n        if (typeof o.direction !== 'undefined') {\n            if (o.direction === 'vertical') {\n                this.makeVertical();\n            } else if (o.direction === 'horizontal') {\n                this.makeHorizontal();\n            }\n        }\n        if (typeof o.data !== 'undefined') {\n            this.updateData(o.data);\n        }\n    }\n}\n\nexport default FunnelGraph;\n","import React from 'react'\nimport { Card } from 'lib/utils'\nimport { Link } from 'lib/components/Link'\nimport { actionsModel } from '~/models/actionsModel'\nimport { useValues, useActions } from 'kea'\nimport { funnelLogic } from './funnelLogic'\nimport { ActionFilter } from 'scenes/trends/ActionFilter/ActionFilter'\nimport { PropertyFilters } from 'lib/components/PropertyFilters/PropertyFilters'\nimport { Button } from 'antd'\nimport { userLogic } from 'scenes/userLogic'\n\nexport function EditFunnel({ funnelId }) {\n    const { funnel, isStepsEmpty } = useValues(funnelLogic({ id: funnelId }))\n    const { setFunnel, updateFunnel, createFunnel } = useActions(funnelLogic({ id: funnelId }))\n    const { actions, actionsLoading } = useValues(actionsModel())\n    const { eventProperties } = useValues(userLogic)\n\n    return (\n        <form\n            onSubmit={e => {\n                e.preventDefault()\n                if (!funnel.id) {\n                    createFunnel(funnel)\n                } else {\n                    updateFunnel(funnel)\n                }\n            }}\n        >\n            <Card>\n                <div className=\"card-body\">\n                    <input\n                        required\n                        placeholder=\"User drop off through signup\"\n                        type=\"text\"\n                        autoFocus\n                        onChange={e => setFunnel({ name: e.target.value })}\n                        value={funnel.name || ''}\n                        className=\"form-control\"\n                    />\n                    {!actionsLoading && actions.length === 0 && (\n                        <div className=\"alert alert-warning\" style={{ marginTop: '1rem' }}>\n                            You don't have any actions set up. <Link to=\"/actions\">Click here to set up an action</Link>\n                        </div>\n                    )}\n                    <br />\n                    <ActionFilter\n                        filters={funnel.filters}\n                        setFilters={filters => setFunnel({ filters }, false)}\n                        typeKey={`EditFunnel-${funnel.id || 'new'}`}\n                    />\n                    <br />\n                    <hr />\n                    <h4 className=\"secondary mt-3\">Filters</h4>\n                    <PropertyFilters\n                        pageKey={`EditFunnel-${funnel.id || 'new'}`}\n                        properties={eventProperties}\n                        propertyFilters={funnel.filters.properties || []}\n                        onChange={properties =>\n                            setFunnel({\n                                filters: {\n                                    properties,\n                                },\n                            })\n                        }\n                        style={{ marginBottom: 0 }}\n                    />\n                    <hr />\n                    <Button type=\"primary mt-3\" htmlType=\"submit\" disabled={isStepsEmpty}>\n                        Save funnel\n                    </Button>\n                    <br />\n                    {isStepsEmpty && <small>Add some actions/events to save the funnel</small>}\n                </div>\n            </Card>\n        </form>\n    )\n}\n","import React from 'react'\nimport { useValues } from 'kea'\nimport { funnelLogic } from './funnelLogic'\nimport { Link } from 'lib/components/Link'\nimport { Card, percentage, Loading } from 'lib/utils'\nimport { EntityTypes } from 'scenes/trends/trendsLogic'\n\nexport function People({ id }) {\n    const { stepsWithCount, peopleSorted, peopleLoading } = useValues(funnelLogic({ id }))\n\n    return (\n        <Card title=\"Per user\">\n            {peopleLoading && <Loading />}\n            <table className=\"table table-bordered table-fixed\">\n                <tbody>\n                    <tr>\n                        <th />\n                        {stepsWithCount &&\n                            stepsWithCount.map((step, index) => (\n                                <th key={index}>\n                                    {step.type === EntityTypes.ACTIONS ? (\n                                        <Link to={'/action/' + step.action_id}>{step.name}</Link>\n                                    ) : (\n                                        step.name\n                                    )}\n                                </th>\n                            ))}\n                    </tr>\n                    <tr>\n                        <td />\n                        {stepsWithCount &&\n                            stepsWithCount.map((step, index) => (\n                                <td key={index}>\n                                    {step.count}&nbsp; ({percentage(step.count / stepsWithCount[0].count)})\n                                </td>\n                            ))}\n                    </tr>\n                    {peopleSorted &&\n                        peopleSorted.map(person => (\n                            <tr key={person.id}>\n                                <td className=\"text-overflow\">\n                                    <Link to={`/person_by_id/${person.id}`}>{person.name}</Link>\n                                </td>\n                                {stepsWithCount.map((step, index) => (\n                                    <td\n                                        key={index}\n                                        className={\n                                            step.people.indexOf(person.id) > -1 ? 'funnel-success' : 'funnel-dropped'\n                                        }\n                                    />\n                                ))}\n                            </tr>\n                        ))}\n                </tbody>\n            </table>\n        </Card>\n    )\n}\n","import React from 'react'\nimport { Card, Loading } from '../../lib/utils'\nimport { SaveToDashboard } from '../../lib/components/SaveToDashboard'\nimport { DateFilter } from '../../lib/components/DateFilter'\nimport { EditFunnel } from './EditFunnel'\nimport { FunnelViz } from './FunnelViz'\nimport { People } from './People'\nimport { funnelLogic } from './funnelLogic'\nimport { useValues, useActions } from 'kea'\n\nexport function Funnel({ id }) {\n    const { funnel, funnelLoading, stepsWithCount, stepsWithCountLoading } = useValues(funnelLogic({ id }))\n    const { setFunnel } = useActions(funnelLogic({ id }))\n    if (!funnel && funnelLoading) return <Loading />\n    return (\n        <div className=\"funnel\">\n            {funnel.id ? <h1>Funnel: {funnel.name}</h1> : <h1>New funnel</h1>}\n            <EditFunnel funnelId={id} />\n\n            {funnel.id && (\n                <Card\n                    title={\n                        <span>\n                            <span className=\"float-right\">\n                                <DateFilter\n                                    onChange={(date_from, date_to) =>\n                                        setFunnel(\n                                            {\n                                                filters: {\n                                                    date_from,\n                                                    date_to,\n                                                },\n                                            },\n                                            true\n                                        )\n                                    }\n                                    dateFrom={funnel.filters.date_from}\n                                    dateTo={funnel.filters.date_to}\n                                />\n                                <SaveToDashboard\n                                    filters={{ funnel_id: funnel.id }}\n                                    type=\"FunnelViz\"\n                                    name={funnel.name}\n                                />\n                            </span>\n                            Graph\n                        </span>\n                    }\n                >\n                    <div style={{ height: 300 }}>\n                        {stepsWithCountLoading && <Loading />}\n                        {stepsWithCount && stepsWithCount[0] && stepsWithCount[0].count > -1 && (\n                            <FunnelViz funnel={{ steps: stepsWithCount }} />\n                        )}\n                    </div>\n                </Card>\n            )}\n            {funnel.id && <People id={id} />}\n        </div>\n    )\n}\n"],"sourceRoot":""}