{"version":3,"sources":["webpack:///./frontend/src/lib/utils.js","webpack:///./node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack:///./node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack:///./node_modules/@babel/runtime/helpers/iterableToArray.js","webpack:///./node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack:///./frontend/src/lib/components/DateFilter.js","webpack:///./frontend/src/scenes/paths/Paths.js"],"names":["uuid","replace","c","crypto","getRandomValues","Uint8Array","toString","toParams","obj","Object","entries","filter","map","key","val","_isAMomentObject","encodeURIComponent","format","JSON","stringify","handleVal","join","fromParams","window","location","search","slice","split","reduce","a","b","decodeURIComponent","percentage","division","toLocaleString","undefined","style","maximumFractionDigits","Loading","className","TableRowLoading","colSpan","asOverlay","padding","textAlign","CloseButton","props","aria-hidden","Card","title","children","DeleteWithUndo","href","onClick","e","preventDefault","deleteWithUndo","undo","api","update","endpoint","object","id","deleted","then","callback","response","name","toast","toastId","propTypes","PropTypes","string","isRequired","shape","number","selectStyle","control","base","height","minHeight","indicatorsContainer","input","paddingBottom","paddingTop","margin","opacity","valueContainer","marginTop","option","debounce","func","wait","immediate","timeout","context","this","args","arguments","later","apply","callNow","clearTimeout","setTimeout","capitalizeFirstLetter","charAt","toUpperCase","operatorMap","exact","is_not","icontains","not_icontains","gt","lt","operatorEntries","reverse","formatFilterName","str","value","includes","deletePersonData","person","confirm","objectsEqual","obj1","obj2","arrayWithoutHoles","iterableToArray","unsupportedIterableToArray","nonIterableSpread","module","exports","arr","arrayLikeToArray","Array","isArray","iter","Symbol","iterator","from","TypeError","dateMapping","Today","Yesterday","isDate","DateFilter","setState","open","dateRangeOpen","from_date","to_date","onChange","v","state","setDate","document","getElementById","focus","date","rangeDateFrom","rangeDateTo","moment","test","dateFrom","toDate","dateTo","date_from","date_to","isMoment","bordered","dateFilterToText","marginRight","onBlur","listHeight","dropdownMatchSelectWidth","dropdownRender","menu","DatePickerDropdown","dropdownOnClick","onDateFromChange","onDateToChange","onApplyClick","onClickOutside","Option","Component","dropdownRef","useRef","useState","calendarOpen","setCalendarOpen","event","current","contains","target","useEffect","addEventListener","removeEventListener","ref","color","fontWeight","popupStyle","zIndex","onOpenChange","defaultValue","type","disabled","marginBottom","stripHTTP","url","NoData","display","Paths","paths","d3Loaded","sankeyLoaded","querySelectorAll","forEach","node","parentNode","removeChild","nodes","length","rendered","width","canvas","offsetWidth","offsetHeight","svg","d3","select","append","sankey","nodeId","d","nodeAlign","sankeyLeft","nodeSort","nodeWidth","size","assign","links","selectAll","data","attr","x0","y0","y1","x1","sourceLinks","link","targetLinks","darker","text","dropOffGradient","sankeyLinkHorizontal","Math","max","source","layer","x","y","w","h","r","retval","prev","curr","min","round","textSelection","substring","params","get","path","dataLoaded","renderPaths","changes","fetchPaths","bind","React","createRef","updateFilter"],"mappings":"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","file":"paths.js","sourcesContent":["import React from 'react'\nimport api from './api'\nimport { toast } from 'react-toastify'\nimport PropTypes from 'prop-types'\nimport { Spin } from 'antd'\n\nexport function uuid() {\n    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n        (c ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))).toString(16)\n    )\n}\n\nexport let toParams = obj => {\n    let handleVal = val => {\n        if (val._isAMomentObject) return encodeURIComponent(val.format('YYYY-MM-DD'))\n        val = typeof val === 'object' ? JSON.stringify(val) : val\n        return encodeURIComponent(val)\n    }\n    return Object.entries(obj)\n        .filter(([key, val]) => val)\n        .map(([key, val]) => `${key}=${handleVal(val)}`)\n        .join('&')\n}\nexport let fromParams = () =>\n    window.location.search != ''\n        ? window.location.search\n              .slice(1)\n              .split('&')\n              .reduce((a, b) => {\n                  b = b.split('=')\n                  a[b[0]] = decodeURIComponent(b[1])\n                  return a\n              }, {})\n        : {}\n\nexport let colors = ['success', 'secondary', 'warning', 'primary', 'danger', 'info', 'dark', 'light']\nexport let percentage = division =>\n    division\n        ? division.toLocaleString(undefined, {\n              style: 'percent',\n              maximumFractionDigits: 2,\n          })\n        : ''\n\nexport let Loading = () => (\n    <div className=\"loading-overlay\">\n        <div></div>\n        <Spin />\n    </div>\n)\n\nexport const TableRowLoading = ({ colSpan = 1, asOverlay = false }) => (\n    <tr className={asOverlay ? 'loading-overlay over-table' : ''}>\n        <td colSpan={colSpan} style={{ padding: 50, textAlign: 'center' }}>\n            <Spin />\n        </td>\n    </tr>\n)\n\nexport let CloseButton = props => {\n    return (\n        <span {...props} className={'close cursor-pointer ' + props.className} style={{ ...props.style }}>\n            <span aria-hidden=\"true\">&times;</span>\n        </span>\n    )\n}\n\nexport function Card(props) {\n    return (\n        <div {...props} className={'card ' + props.className} style={props.style} title=\"\">\n            {props.title && <div className=\"card-header\">{props.title}</div>}\n            {props.children}\n        </div>\n    )\n}\n\nexport let DeleteWithUndo = props => {\n    let deleteWithUndo = undo => {\n        api.update('api/' + props.endpoint + '/' + props.object.id, {\n            ...props.object,\n            deleted: undo ? false : true,\n        }).then(() => {\n            props.callback()\n            let response = (\n                <div>\n                    {!undo ? (\n                        <span>\n                            \"<strong>{props.object.name}</strong>\" deleted.{' '}\n                            <a\n                                href=\"#\"\n                                onClick={e => {\n                                    e.preventDefault()\n                                    deleteWithUndo(true)\n                                }}\n                            >\n                                Click here to undo\n                            </a>\n                        </span>\n                    ) : (\n                        <span>Delete un-done</span>\n                    )}\n                </div>\n            )\n            toast(response, { toastId: 'delete-item-' + props.object.id })\n        })\n    }\n\n    return (\n        <a\n            href=\"#\"\n            onClick={e => {\n                e.preventDefault()\n                deleteWithUndo()\n            }}\n            className={props.className}\n            style={props.style}\n        >\n            {props.children}\n        </a>\n    )\n}\nDeleteWithUndo.propTypes = {\n    endpoint: PropTypes.string.isRequired,\n    object: PropTypes.shape({\n        name: PropTypes.string.isRequired,\n        id: PropTypes.number.isRequired,\n    }).isRequired,\n    className: PropTypes.string,\n    style: PropTypes.object,\n}\n\nexport let selectStyle = {\n    control: base => ({\n        ...base,\n        height: 31,\n        minHeight: 31,\n    }),\n    indicatorsContainer: base => ({\n        ...base,\n        height: 31,\n    }),\n    input: base => ({\n        ...base,\n        paddingBottom: 0,\n        paddingTop: 0,\n        margin: 0,\n        opacity: 1,\n    }),\n    valueContainer: base => ({\n        ...base,\n        padding: '0 8px',\n        marginTop: -2,\n    }),\n    option: base => ({\n        ...base,\n        padding: '2px 15px',\n    }),\n}\n\nexport let debounce = (func, wait, immediate) => {\n    var timeout\n    return function() {\n        var context = this,\n            args = arguments\n        var later = function() {\n            timeout = null\n            if (!immediate) func.apply(context, args)\n        }\n        var callNow = immediate && !timeout\n        clearTimeout(timeout)\n        timeout = setTimeout(later, wait)\n        if (callNow) func.apply(context, args)\n    }\n}\n\nexport const capitalizeFirstLetter = string => {\n    return string.charAt(0).toUpperCase() + string.slice(1)\n}\n\nexport const operatorMap = {\n    exact: '= equals',\n    is_not: \"≠ doesn't equal\",\n    icontains: '∋ contains',\n    not_icontains: \"∌ doesn't contain\",\n    gt: '> greater than',\n    lt: '< lower than',\n}\n\nconst operatorEntries = Object.entries(operatorMap).reverse()\n\nexport const formatFilterName = str => {\n    for (let [key, value] of operatorEntries) {\n        if (str.includes(key)) return str.replace('__' + key, '') + ` ${value.split(' ')[0]} `\n    }\n    return str + ` ${operatorMap['exact'].split(' ')[0]} `\n}\n\nexport const deletePersonData = (person, callback) => {\n    window.confirm('Are you sure you want to delete this user? This cannot be undone') &&\n        api.delete('api/person/' + person.id).then(() => {\n            toast('Person succesfully deleted.')\n            if (callback) callback()\n        })\n}\n\nexport const objectsEqual = (obj1, obj2) => JSON.stringify(obj1) === JSON.stringify(obj2)\n","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;","import React, { Component, useRef, useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Select, DatePicker, Button } from 'antd'\n\nimport moment from 'moment'\n\nlet dateMapping = {\n    Today: ['dStart'],\n    Yesterday: ['-1d', 'dStart'],\n    'Last week': ['-7d'],\n    'Last 2 weeks': ['-14d'],\n    'Last 30 days': ['-30d'],\n    'Last 90 days': ['-90d'],\n    'This month': ['mStart'],\n    'Previous month': ['-1mStart', '-1mEnd'],\n    'Year to date': ['yStart'],\n    'All time': ['all'],\n}\n\nlet isDate = /([0-9]{4}-[0-9]{2}-[0-9]{2})/\n\nexport class DateFilter extends Component {\n    static propTypes = {\n        onChange: PropTypes.func.isRequired,\n    }\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            rangeDateFrom: isDate.test(props.dateFrom) && moment(props.dateFrom).toDate(),\n            rangeDateTo: isDate.test(props.dateTo) && moment(props.dateTo).toDate(),\n            dateRangeOpen: false,\n            open: false,\n        }\n    }\n\n    onClickOutside = () => {\n        this.setState({\n            open: false,\n            dateRangeOpen: false,\n        })\n    }\n\n    setDate = (from_date, to_date) => {\n        this.props.onChange(from_date, to_date)\n    }\n\n    dateFilterToText(date_from, date_to) {\n        if (isDate.test(date_from)) return `${date_from} - ${date_to}`\n        if (moment.isMoment(date_from)) return `${date_from.format('YYYY-MM-DD')} - ${date_to.format('YYYY-MM-DD')}`\n        let name = 'Last 7 days'\n        Object.entries(dateMapping).map(([key, value]) => {\n            if (value[0] === date_from && value[1] === date_to) name = key\n        })[0]\n        return name\n    }\n\n    onChange = v => {\n        if (v === 'Date range') {\n            if (this.state.open) {\n                this.setState({ dateRangeOpen: true, open: false })\n            }\n        } else this.setDate(dateMapping[v][0], dateMapping[v][1])\n    }\n\n    onBlur = () => {\n        if (this.state.dateRangeOpen) return\n        this.setState({\n            open: false,\n            dateRangeOpen: false,\n        })\n    }\n\n    onClick = () => {\n        if (this.state.dateRangeOpen) return\n        this.setState({\n            open: !this.state.open,\n        })\n    }\n\n    dropdownOnClick = e => {\n        e.preventDefault()\n        this.setState({ dateRangeOpen: false, open: true })\n        document.getElementById('daterange_selector').focus()\n    }\n\n    onDateFromChange = date => this.setState({ rangeDateFrom: date })\n\n    onDateToChange = date => this.setState({ rangeDateTo: date })\n\n    onApplyClick = () => {\n        this.setState({\n            dateRangeOpen: false,\n            open: false,\n        })\n        this.props.onChange(\n            moment(this.state.rangeDateFrom).format('YYYY-MM-DD'),\n            moment(this.state.rangeDateTo).format('YYYY-MM-DD')\n        )\n    }\n\n    render() {\n        let { rangeDateFrom, rangeDateTo } = this.state\n        return (\n            <Select\n                bordered={false}\n                id=\"daterange_selector\"\n                value={this.dateFilterToText(this.props.dateFrom, this.props.dateTo)}\n                onChange={this.onChange}\n                style={{\n                    marginRight: 4,\n                    ...this.props.style,\n                }}\n                open={this.state.open || this.state.dateRangeOpen}\n                onBlur={this.onBlur}\n                onClick={this.onClick}\n                listHeight={400}\n                dropdownMatchSelectWidth={false}\n                dropdownRender={menu => {\n                    if (this.state.dateRangeOpen) {\n                        return (\n                            <DatePickerDropdown\n                                onClick={this.dropdownOnClick}\n                                onDateFromChange={this.onDateFromChange}\n                                onDateToChange={this.onDateToChange}\n                                onApplyClick={this.onApplyClick}\n                                onClickOutside={this.onClickOutside}\n                                rangeDateFrom={rangeDateFrom}\n                                rangeDateTo={rangeDateTo}\n                            />\n                        )\n                    } else if (this.state.open) {\n                        return menu\n                    }\n                }}\n            >\n                {[\n                    ...Object.entries(dateMapping).map(([key, value]) => {\n                        return (\n                            <Select.Option key={key} value={key}>\n                                {key}\n                            </Select.Option>\n                        )\n                    }),\n\n                    <Select.Option key={'Date range'} value={'Date range'}>\n                        {'Date range'}\n                    </Select.Option>,\n                ]}\n            </Select>\n        )\n    }\n}\n\nfunction DatePickerDropdown(props) {\n    const dropdownRef = useRef()\n    let [calendarOpen, setCalendarOpen] = useState(false)\n\n    let onClickOutside = event => {\n        if (!dropdownRef.current.contains(event.target) && !calendarOpen) {\n            props.onClickOutside()\n        }\n    }\n\n    useEffect(() => {\n        document.addEventListener('mousedown', onClickOutside)\n        return () => {\n            document.removeEventListener('mousedown', onClickOutside)\n        }\n    }, [calendarOpen])\n\n    return (\n        <div className=\"dropdown\" ref={dropdownRef}>\n            <a\n                style={{\n                    margin: '0 1rem',\n                    color: 'rgba(0, 0, 0, 0.2)',\n                    fontWeight: 700,\n                }}\n                href=\"#\"\n                onClick={props.onClick}\n            >\n                &lt;\n            </a>\n            <hr style={{ margin: '0.5rem 0' }} />\n            <div style={{ padding: '0 1rem' }}>\n                <label className=\"secondary\">From date</label>\n                <br />\n                <DatePicker\n                    popupStyle={{ zIndex: 999999 }}\n                    onOpenChange={open => {\n                        setCalendarOpen(open)\n                    }}\n                    defaultValue={\n                        props.rangeDateFrom\n                            ? moment.isMoment(props.rangeDateFrom)\n                                ? props.rangeDateFrom\n                                : moment(props.rangeDateFrom)\n                            : null\n                    }\n                    onChange={props.onDateFromChange}\n                />\n                <br />\n                <br />\n                <label className=\"secondary\">To date</label>\n                <br />\n                <DatePicker\n                    popupStyle={{ zIndex: 999999 }}\n                    onOpenChange={open => setCalendarOpen(open)}\n                    defaultValue={\n                        props.rangeDateTo\n                            ? moment.isMoment(props.rangeDateTo)\n                                ? props.rangeDateTo\n                                : moment(props.rangeDateTo)\n                            : null\n                    }\n                    onChange={props.onDateToChange}\n                />\n                <br />\n                <Button\n                    type=\"default\"\n                    disabled={!props.rangeDateTo || !props.rangeDateFrom}\n                    style={{ marginTop: '1rem', marginBottom: '1rem' }}\n                    onClick={props.onApplyClick}\n                >\n                    Apply filter\n                </Button>\n            </div>\n        </div>\n    )\n}\n","import React, { Component } from 'react'\nimport api from 'lib/api'\nimport { toParams, Card } from 'lib/utils'\nimport { DateFilter } from 'lib/components/DateFilter'\nimport { Spin } from 'antd'\n\nlet stripHTTP = url => url.replace(/(^[0-9]+_\\w+:|^)\\/\\//, '')\n\nfunction rounded_rect(x, y, w, h, r, tl, tr, bl, br) {\n    var retval\n    retval = 'M' + (x + r) + ',' + y\n    retval += 'h' + (w - 2 * r)\n    if (tr) {\n        retval += 'a' + r + ',' + r + ' 0 0 1 ' + r + ',' + r\n    } else {\n        retval += 'h' + r\n        retval += 'v' + r\n    }\n    retval += 'v' + (h - 2 * r)\n    if (br) {\n        retval += 'a' + r + ',' + r + ' 0 0 1 ' + -r + ',' + r\n    } else {\n        retval += 'v' + r\n        retval += 'h' + -r\n    }\n    retval += 'h' + (2 * r - w)\n    if (bl) {\n        retval += 'a' + r + ',' + r + ' 0 0 1 ' + -r + ',' + -r\n    } else {\n        retval += 'h' + -r\n        retval += 'v' + -r\n    }\n    retval += 'v' + (2 * r - h)\n    if (tl) {\n        retval += 'a' + r + ',' + r + ' 0 0 1 ' + r + ',' + -r\n    } else {\n        retval += 'v' + -r\n        retval += 'h' + r\n    }\n    retval += 'z'\n    return retval\n}\n\nfunction NoData() {\n    return (\n        <div style={{ padding: '1rem' }}>\n            We don't have enough data to show anything here. You might need to send us some frontend (JS) events, as we\n            use the <pre style={{ display: 'inline' }}>$current_url</pre> property to calculate paths.\n        </div>\n    )\n}\n\nexport class Paths extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            filter: {\n                dateFrom: null,\n                dateTo: null,\n            },\n            paths: {\n                nodes: [],\n                links: [],\n            },\n            d3Loaded: false,\n            sankeyLoaded: false,\n        }\n        this.fetchPaths = this.fetchPaths.bind(this)\n        this.canvas = React.createRef()\n\n        this.fetchPaths()\n        import('d3').then(d3 => {\n            this.d3 = d3\n            this.setState({ d3Loaded: true })\n        })\n        import('d3-sankey').then(sankey => {\n            this.sankey = sankey\n            this.setState({ sankeyLoaded: true })\n        })\n    }\n\n    renderPaths = () => {\n        const { paths } = this.state\n\n        if (!this.state.d3Loaded || !this.state.sankeyLoaded) {\n            return\n        }\n\n        const elements = document.querySelectorAll('.paths svg')\n        elements.forEach(node => node.parentNode.removeChild(node))\n\n        if (!paths || paths.nodes.length === 0) {\n            this.setState({ rendered: true })\n            return\n        }\n\n        this.setState({ rendered: true })\n        let width = this.canvas.current.offsetWidth\n        let height = this.canvas.current.offsetHeight\n\n        let svg = this.d3\n            .select(this.canvas.current)\n            .append('svg')\n            .style('background', '#fff')\n            .style('width', width)\n            .style('height', height)\n        let sankey = new this.sankey.sankey()\n            .nodeId(d => d.name)\n            .nodeAlign(this.sankey.sankeyLeft)\n            .nodeSort(null)\n            .nodeWidth(15)\n            // .nodePadding()\n            .size([width, height])\n        let color = name => this.d3.scaleOrdinal(this.d3.interpolateBlues())(name.replace(/ .*/, ''))\n\n        const { nodes, links } = sankey({\n            nodes: paths.nodes.map(d => Object.assign({}, d)),\n            links: paths.links.map(d => Object.assign({}, d)),\n        })\n\n        svg.append('g')\n            .selectAll('rect')\n            .data(nodes)\n            .join('rect')\n            .attr('x', d => d.x0 + 1)\n            .attr('y', d => d.y0)\n            .attr('height', d => d.y1 - d.y0)\n            .attr('width', d => d.x1 - d.x0 - 2)\n            .attr('fill', d => {\n                let c\n                for (const link of d.sourceLinks) {\n                    if (c === undefined) c = link.color\n                    else if (c !== link.color) c = null\n                }\n                if (c === undefined)\n                    for (const link of d.targetLinks) {\n                        if (c === undefined) c = link.color\n                        else if (c !== link.color) c = null\n                    }\n                return (this.d3.color(c) || this.d3.color('#dddddd')).darker(0.5)\n            })\n            // .attr(\"fill\", d =>  'var(--blue)')\n            .attr('opacity', 0.5)\n            .append('title')\n            .text(d => `${stripHTTP(d.name)}\\n${d.value.toLocaleString()}`)\n\n        const dropOffGradient = svg\n            .append('defs')\n            .append('linearGradient')\n            .attr('id', 'dropoff-gradient')\n            .attr('gradientTransform', 'rotate(90)')\n\n        dropOffGradient\n            .append('stop')\n            .attr('offset', '0%')\n            .attr('stop-color', 'rgba(220,53,69,0.7)')\n\n        dropOffGradient\n            .append('stop')\n            .attr('offset', '100%')\n            .attr('stop-color', '#ffffff')\n\n        const link = svg\n            .append('g')\n            .attr('fill', 'none')\n            .selectAll('g')\n            .data(links)\n            .join('g')\n            .attr('stroke', d => 'var(--blue)')\n            .attr('opacity', 0.3)\n            .style('mix-blend-mode', 'multiply')\n\n        link.append('path')\n            .attr('d', this.sankey.sankeyLinkHorizontal())\n            .attr('stroke-width', d => {\n                return Math.max(1, d.width)\n            })\n\n        link.append('g')\n            .append('path')\n            .attr('d', (data, b, c) => {\n                if (data.source.layer == 0) return\n                let height =\n                    data.source.y1 -\n                    data.source.y0 -\n                    data.source.sourceLinks.reduce((prev, curr) => prev + curr.width, 0)\n                return rounded_rect(0, 0, 30, height, Math.min(25, height), false, true, false, false)\n            })\n            .attr('fill', 'url(#dropoff-gradient)')\n            .attr('stroke-width', 0)\n            .attr('transform', data => {\n                return (\n                    'translate(' +\n                    Math.round(data.source.x1) +\n                    ',' +\n                    Math.round(data.source.y0 + data.source.sourceLinks.reduce((prev, curr) => prev + curr.width, 0)) +\n                    ')'\n                )\n            })\n            .append('tspan')\n            .text(d => {\n                return d.value - d.source.sourceLinks.reduce((prev, curr) => prev + curr.value, 0)\n            })\n\n        link.append('title').text(d => `${d.source.name} → ${d.target.name}\\n${d.value.toLocaleString()}`)\n\n        var textSelection = svg\n            .append('g')\n            .style('font-size', '12px')\n            .selectAll('text')\n            .data(nodes)\n            .join('text')\n            .attr('x', d => (d.x0 < width / 2 ? d.x1 + 6 : d.x0 - 6))\n            .attr('y', d => (d.y1 + d.y0) / 2)\n            .attr('dy', '0.35em')\n            .attr('text-anchor', d => (d.x0 < width / 2 ? 'start' : 'end'))\n            .attr('display', d => (d.value > 0 ? 'inherit' : 'none'))\n            .text(d =>\n                d.name.length > 35\n                    ? stripHTTP(d.name).substring(0, 6) + '...' + stripHTTP(d.name).slice(-15)\n                    : stripHTTP(d.name)\n            )\n\n        textSelection\n            .append('tspan')\n            .attr('fill-opacity', 0.7)\n            .text(d => ` ${d.value.toLocaleString()}`)\n\n        textSelection.append('title').text(d => stripHTTP(d.name))\n\n        return textSelection.node()\n    }\n\n    fetchPaths = () => {\n        const params = toParams(this.state.filter)\n\n        api.get(`api/paths${params ? `/?${params}` : ''}`).then(paths => {\n            this.setState(\n                {\n                    paths: {\n                        nodes: [\n                            ...paths.map(path => ({ name: path.source })),\n                            ...paths.map(path => ({ name: path.target })),\n                        ],\n                        links: paths,\n                    },\n                    dataLoaded: true,\n                },\n                this.renderPaths\n            )\n        })\n    }\n\n    updateFilter = changes => {\n        this.setState(\n            { filter: { ...this.state.filter, ...changes }, rendered: false, dataLoaded: false },\n            this.fetchPaths\n        )\n    }\n\n    render() {\n        let { paths, filter, dataLoaded } = this.state\n\n        return (\n            <div>\n                <h1>Paths</h1>\n                <Card\n                    title={\n                        <span>\n                            <span className=\"float-right\">\n                                <DateFilter\n                                    onChange={(date_from, date_to) =>\n                                        this.updateFilter({\n                                            date_from,\n                                            date_to,\n                                        })\n                                    }\n                                    dateFrom={filter.date_from}\n                                    dateTo={filter.date_to}\n                                />\n                            </span>\n                        </span>\n                    }\n                >\n                    <div ref={this.canvas} className=\"paths\" style={{ height: '90vh' }}>\n                        {dataLoaded && paths && paths.nodes.length === 0 ? (\n                            <NoData />\n                        ) : (\n                            !dataLoaded && (\n                                <div style={{ paddingTop: '14rem', textAlign: 'center' }}>\n                                    <div />\n                                    <Spin />\n                                    <br />\n                                    <br />\n                                    (This might take a while)\n                                </div>\n                            )\n                        )}\n                    </div>\n                </Card>\n            </div>\n        )\n    }\n}\n"],"sourceRoot":""}